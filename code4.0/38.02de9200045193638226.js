(this.webpackJsonp=this.webpackJsonp||[]).push([[38],{Cbrn:function(e,t,n){"use strict";n.r(t),n.d(t,"QrCodeDialogComponent",(function(){return q}));var r=n("lwsE"),o=n.n(r),i=n("W8MJ"),c=n.n(i),a=n("a1gu"),s=n.n(a),l=n("Nsbk"),u=n.n(l),d=n("7W2i"),f=n.n(d),m=n("q1tI"),h=n("ANjH"),p=n("/MKj"),g=n("2OET"),v=n("4NMw"),w=n("CG87"),y=n("G72A"),_=n("WFO7"),b=n("5nG9"),E=n("cLAn"),P=n.n(E);n("l9dq");var k=function(e){function t(e){var n;return o()(this,t),(n=s()(this,u()(t).call(this,e))).qr=void 0,n.link_input=void 0,n.on_request_close=function(){n.props.close_dialog({dialog_type:"qrcode"})},n.download=function(){if(document.getElementById("qrcode-dialog-content")){var e=document.getElementById("post_container"),t=document.getElementById("qrcode-dialog-content");if(t){var r=t.cloneNode(!0);e.append(r);P.a.toPng(e,{height:2*e.offsetHeight,width:2*e.offsetWidth,style:{transform:"scale(".concat(2,")"),transformOrigin:"top left",width:"".concat(e.offsetWidth,"px"),height:"".concat(e.offsetHeight,"px")}}).then((function(e){var t=document.createElement("a");t.href=e,t.download=n.props.work_name,t.target="_blank",t.click()})).catch((function(e){}))}}},n.copy_link=function(){document.designMode="on",n.link_input.value=n.get_player_url(),n.link_input.select(),document.execCommand("copy",!1,void 0)&&n.props.show_toast({content:"qrcode_share/copy_success",type:"success"}),document.designMode="off"},n.get_intl_msg=function(e){return n.props.intl.formatMessage({id:e})},n}return f()(t,e),c()(t,[{key:"get_player_url",value:function(){return"".concat(Object(_.a)().player,"/new/preview?bcmc_url=").concat(this.props.bcmc_url)}},{key:"render",value:function(){var e=this,t=this.get_player_url();return this.qr=v(10,"M"),this.qr.addData("".concat(t,"?origin=kitten_qrcode")),this.qr.make(),m.createElement(w.a,{type:"qrcode",class_name:"k-qrcode-dialog",on_request_close:this.on_request_close,close_btn:!1},m.createElement("div",{id:"qrcode-dialog",className:"qrcode-dialog--3Vc5X"},m.createElement("div",{className:"actions--2-k2B"},m.createElement("span",{className:"download_post--1sjhS btn--3z_lL"},m.createElement("span",{className:"icon--2ICTe","data-report-click":"手机预览-生成海报",onClick:this.download}),m.createElement("span",{className:"text--txmlg"},this.get_intl_msg("qrcode_share/post"))),m.createElement("span",{className:"copy_link--3xhp3 btn--3z_lL"},m.createElement("span",{className:"icon--2ICTe","data-report-click":"手机预览-复制链接",onClick:this.copy_link}),m.createElement("span",{className:"text--txmlg"},this.get_intl_msg("qrcode_share/link")))),m.createElement("div",{className:"qrcode-dialog-content-wrap--26bjZ"},m.createElement("div",{id:"qrcode-dialog-content",className:"qrcode-dialog-content--2yzzs"},m.createElement("div",{id:"post_container",className:"post_container--WvwU6"}),m.createElement("div",{className:"mask--2AESP"}),m.createElement("div",{className:"content--fuPi7"},m.createElement("span",{className:"title--kaCYU"},"·".concat(this.props.work_name,"·")),m.createElement("span",{className:"user_name--1gmRx"},this.props.user_name),m.createElement("div",{className:"qrcode-wrap--3L3Oj"},m.createElement("div",{className:"qrcode-img--1JdTR",dangerouslySetInnerHTML:{__html:this.qr.createSvgTag(3.55,4)}})),m.createElement("p",{className:"tip--2YqOz"},this.get_intl_msg("qrcode_share/tip-1"),m.createElement("br",null),this.get_intl_msg("qrcode_share/tip-2")))))),m.createElement("div",{className:"btn-close--31iv1",onClick:this.on_request_close}),m.createElement("input",{type:"text",className:"link--2hdaI",ref:function(t){t&&(e.link_input=t)}}))}}]),t}(m.Component);var q=Object(g.b)(Object(p.connect)((function(e){return{work_id:e.project_state.work_id,work_name:e.project_state.work_name,user_name:e.userinfo_state.nickname,bcmc_url:e.project_state.bcmc_url}}),(function(e){return Object(h.bindActionCreators)({close_dialog:y.c,show_toast:b.d},e)}))(k))},cLAn:function(e,t,n){!function(t){"use strict";var n=function(){return{escape:function(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:t,mimeType:function(e){var n=t(e).toLowerCase();return(r="application/font-woff",{woff:r,woff2:r,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"})[n]||"";var r},dataAsUrl:function(e,t){return"data:"+t+";base64,"+e},isDataUrl:function(e){return-1!==e.search(/^(data:)/)},canvasToBlob:function(e){return e.toBlob?new Promise((function(t){e.toBlob(t)})):function(e){return new Promise((function(t){for(var n=window.atob(e.toDataURL().split(",")[1]),r=n.length,o=new Uint8Array(r),i=0;i<r;i++)o[i]=n.charCodeAt(i);t(new Blob([o],{type:"image/png"}))}))}(e)},resolveUrl:function(e,t){var n=document.implementation.createHTMLDocument(),r=n.createElement("base");n.head.appendChild(r);var o=n.createElement("a");return n.body.appendChild(o),r.href=t,o.href=e,o.href},getAndEncode:function(e){a.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());return new Promise((function(t){var n,r=new XMLHttpRequest;if(r.onreadystatechange=function(){if(4!==r.readyState)return;if(200!==r.status)return void(n?t(n):i("cannot fetch resource: "+e+", status: "+r.status));var o=new FileReader;o.onloadend=function(){var e=o.result.split(/,/)[1];t(e)},o.readAsDataURL(r.response)},r.ontimeout=function(){n?t(n):i("timeout of 30000ms occured while fetching resource: "+e)},r.responseType="blob",r.timeout=3e4,r.open("GET",e,!0),r.send(),a.impl.options.imagePlaceholder){var o=a.impl.options.imagePlaceholder.split(/,/);o&&o[1]&&(n=o[1])}function i(e){console.error(e),t("")}}))},uid:(e=0,function(){return"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+e++}),delay:function(e){return function(t){return new Promise((function(n){setTimeout((function(){n(t)}),e)}))}},asArray:function(e){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t},escapeXhtml:function(e){return e.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=n,r.src=e}))},width:function(e){var t=n(e,"border-left-width"),r=n(e,"border-right-width");return e.scrollWidth+t+r},height:function(e){var t=n(e,"border-top-width"),r=n(e,"border-bottom-width");return e.scrollHeight+t+r}};var e;function t(e){var t=/\.([^\.\/]*?)$/g.exec(e);return t?t[1]:""}function n(e,t){var n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace("px",""))}}(),r=function(){var e=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(e,n,i){return function(){return!t(e)}()?Promise.resolve(e):Promise.resolve(e).then(r).then((function(t){var r=Promise.resolve(e);return t.forEach((function(e){r=r.then((function(t){return o(t,e,n,i)}))})),r}))},shouldProcess:t,impl:{readUrls:r,inline:o}};function t(t){return-1!==t.search(e)}function r(t){for(var r,o=[];null!==(r=e.exec(t));)o.push(r[1]);return o.filter((function(e){return!n.isDataUrl(e)}))}function o(e,t,r,o){return Promise.resolve(t).then((function(e){return r?n.resolveUrl(e,r):e})).then(o||n.getAndEncode).then((function(e){return n.dataAsUrl(e,n.mimeType(t))})).then((function(r){return e.replace(function(e){return new RegExp("(url\\(['\"]?)("+n.escape(e)+")(['\"]?\\))","g")}(t),"$1"+r+"$3")}))}}(),o=function(){return{resolveAll:function(){return e(document).then((function(e){return Promise.all(e.map((function(e){return e.resolve()})))})).then((function(e){return e.join("\n")}))},impl:{readAll:e}};function e(){return Promise.resolve(n.asArray(document.styleSheets)).then((function(e){var t=[];return e.forEach((function(e){try{n.asArray(e.cssRules||[]).forEach(t.push.bind(t))}catch(t){console.log("Error while reading CSS rules from "+e.href,t.toString())}})),t})).then((function(e){return e.filter((function(e){return e.type===CSSRule.FONT_FACE_RULE})).filter((function(e){return r.shouldProcess(e.style.getPropertyValue("src"))}))})).then((function(t){return t.map(e)}));function e(e){return{resolve:function(){var t=(e.parentStyleSheet||{}).href;return r.inlineAll(e.cssText,t)},src:function(){return e.style.getPropertyValue("src")}}}}}(),i=function(){return{inlineAll:function t(o){return o instanceof Element?function(e){var t=e.style.getPropertyValue("background");return t?r.inlineAll(t).then((function(t){e.style.setProperty("background",t,e.style.getPropertyPriority("background"))})).then((function(){return e})):Promise.resolve(e)}(o).then((function(){return o instanceof HTMLImageElement?e(o).inline():Promise.all(n.asArray(o.childNodes).map((function(e){return t(e)})))})):Promise.resolve(o)},impl:{newImage:e}};function e(e){return{inline:function(t){return n.isDataUrl(e.src)?Promise.resolve():Promise.resolve(e.src).then(t||n.getAndEncode).then((function(t){return n.dataAsUrl(t,n.mimeType(e.src))})).then((function(t){return new Promise((function(n,r){e.onload=n,e.onerror=r,e.src=t}))}))}}}}(),c={imagePlaceholder:void 0,cacheBust:!1},a={toSvg:s,toPng:function(e,t){return l(e,t||{}).then((function(e){return e.toDataURL()}))},toJpeg:function(e,t){return l(e,t=t||{}).then((function(e){return e.toDataURL("image/jpeg",t.quality||1)}))},toBlob:function(e,t){return l(e,t||{}).then(n.canvasToBlob)},toPixelData:function(e,t){return l(e,t||{}).then((function(t){return t.getContext("2d").getImageData(0,0,n.width(e),n.height(e)).data}))},impl:{fontFaces:o,images:i,util:n,inliner:r,options:{}}};function s(e,t){return function(e){void 0===e.imagePlaceholder?a.impl.options.imagePlaceholder=c.imagePlaceholder:a.impl.options.imagePlaceholder=e.imagePlaceholder;void 0===e.cacheBust?a.impl.options.cacheBust=c.cacheBust:a.impl.options.cacheBust=e.cacheBust}(t=t||{}),Promise.resolve(e).then((function(e){return function e(t,r,o){return o||!r||r(t)?Promise.resolve(t).then((function(e){return e instanceof HTMLCanvasElement?n.makeImage(e.toDataURL()):e.cloneNode(!1)})).then((function(e){return i(t,e,r)})).then((function(e){return function(e,t){return t instanceof Element?Promise.resolve().then(r).then(o).then(i).then(c).then((function(){return t})):t;function r(){var r,o;r=window.getComputedStyle(e),o=t.style,r.cssText?o.cssText=r.cssText:function(e,t){n.asArray(e).forEach((function(n){t.setProperty(n,e.getPropertyValue(n),e.getPropertyPriority(n))}))}(r,o)}function o(){[":before",":after"].forEach((function(r){!function(r){var o=window.getComputedStyle(e,r),i=o.getPropertyValue("content");if(""===i||"none"===i)return;var c=n.uid();t.className=t.className+" "+c;var a=document.createElement("style");a.appendChild(function(e,t,r){var o="."+e+":"+t,i=r.cssText?function(e){var t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}(r):function(e){return n.asArray(e).map((function(t){return t+": "+e.getPropertyValue(t)+(e.getPropertyPriority(t)?" !important":"")})).join("; ")+";"}(r);return document.createTextNode(o+"{"+i+"}")}(c,r,o)),t.appendChild(a)}(r)}))}function i(){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}function c(){t instanceof SVGElement&&(t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t instanceof SVGRectElement&&["width","height"].forEach((function(e){var n=t.getAttribute(e);n&&t.style.setProperty(e,n)})))}}(t,e)})):Promise.resolve();function i(t,r,o){var i=t.childNodes;return 0===i.length?Promise.resolve(r):c(r,n.asArray(i),o).then((function(){return r}));function c(t,n,r){var o=Promise.resolve();return n.forEach((function(n){o=o.then((function(){return e(n,r)})).then((function(e){e&&t.appendChild(e)}))})),o}}}(e,t.filter,!0)})).then(u).then(d).then((function(e){t.bgcolor&&(e.style.backgroundColor=t.bgcolor);t.width&&(e.style.width=t.width+"px");t.height&&(e.style.height=t.height+"px");t.style&&Object.keys(t.style).forEach((function(n){e.style[n]=t.style[n]}));return e})).then((function(r){return function(e,t,r){return Promise.resolve(e).then((function(e){return e.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(e)})).then(n.escapeXhtml).then((function(e){return'<foreignObject x="0" y="0" width="100%" height="100%">'+e+"</foreignObject>"})).then((function(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+t+'" height="'+r+'">'+e+"</svg>"})).then((function(e){return"data:image/svg+xml;charset=utf-8,"+e}))}(r,t.width||n.width(e),t.height||n.height(e))}))}function l(e,t){return s(e,t).then(n.makeImage).then(n.delay(100)).then((function(r){var o=function(e){var r=document.createElement("canvas");if(r.width=t.width||n.width(e),r.height=t.height||n.height(e),t.bgcolor){var o=r.getContext("2d");o.fillStyle=t.bgcolor,o.fillRect(0,0,r.width,r.height)}return r}(e);return o.getContext("2d").drawImage(r,0,0),o}))}function u(e){return o.resolveAll().then((function(t){var n=document.createElement("style");return e.appendChild(n),n.appendChild(document.createTextNode(t)),e}))}function d(e){return i.inlineAll(e).then((function(){return e}))}e.exports=a}()},l9dq:function(e,t,n){e.exports={"qrcode-dialog":"qrcode-dialog--3Vc5X",actions:"actions--2-k2B",btn:"btn--3z_lL",icon:"icon--2ICTe",text:"text--txmlg",download_post:"download_post--1sjhS",copy_link:"copy_link--3xhp3","qrcode-dialog-content-wrap":"qrcode-dialog-content-wrap--26bjZ",post_container:"post_container--WvwU6","qrcode-dialog-content":"qrcode-dialog-content--2yzzs",mask:"mask--2AESP",background_img_wrap:"background_img_wrap--TEvBD",content:"content--fuPi7",title:"title--kaCYU",user_name:"user_name--1gmRx","qrcode-wrap":"qrcode-wrap--3L3Oj","qrcode-img":"qrcode-img--1JdTR",tip:"tip--2YqOz","btn-close":"btn-close--31iv1",link:"link--2hdaI",bounceInOut:"bounceInOut--ViNTb"}}}]);