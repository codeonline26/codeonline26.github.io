(this.webpackJsonp=this.webpackJsonp||[]).push([[57],{MRYu:function(t,e,n){"use strict";n.r(e),n.d(e,"EditListDialogComponent",(function(){return q}));var i=n("RIqP"),a=n.n(i),l=n("lwsE"),s=n.n(l),o=n("W8MJ"),_=n.n(o),r=n("a1gu"),c=n.n(r),d=n("Nsbk"),u=n.n(d),m=n("7W2i"),g=n.n(m),p=n("kNvX"),h=n.n(p),v=n("q1tI"),f=n("ANjH"),b=n("/MKj"),y=n("2OET"),k=n("G72A"),E=n("CG87"),x=n("Gzrk"),N=n("WWDN"),w=n("e/E2"),D=n("bdvc"),j=n("lvvT"),C=n("nOP+"),G=(n("kt7H"),{"./style.scss":{container:"container--3t2tJ",header:"header--2-TqD",content:"content--2ysfm",summary:"summary--3Tj8k",summary_label:"summary_label--23H1T",name:"name--GYNa0",length:"length--30iG1",count:"count--3GmSv",length_input:"length_input--13z9K",details:"details--2iihX",empty_content_container:"empty_content_container--2ff94",content_label:"content_label--2lCQd",tips:"tips--px3FR",list_item:"list_item--3lDKb",selected:"selected--Zdjsf",editing:"editing--EpJlp",idx:"idx--30fwI",value_input:"value_input--w_Ot5",remove_btn:"remove_btn--27mGb",footer:"footer--1BGmw"}});var S,O=[0,1e3];!function(t){t.Up="up",t.Down="down"}(S||(S={}));var J=[0,1e3],T=function(t){function e(t){var n;s()(this,e),(n=c()(this,u()(e).call(this,t))).inputs=[],n.content=void 0,n.old_length=0,n.is_enter_add_list=void 0,n.is_click_save=void 0,n.get_list_info=function(){var t=n.props.variable_states[n.props.edit_list_dialog_setting.list_id],e=t.name,i=t.value;return{name:e,value:i,length:i.length}},n.get_intl_msg=function(t){return n.props.intl.formatMessage({id:t})},n.add_input=function(t){return function(e){n.inputs[t]=e}},n.change_focus=function(t){var e=n.inputs[t];e&&(e.focus(),e.parentElement&&Object(D.J)(e.parentElement))},n.on_request_close=function(){n.is_click_save||Object(w.m)("列表-退出编辑"),n.is_click_save=!1,n.props.close_dialog({dialog_type:"edit_list"})},n.update_list=function(t,e){n.setState({list_value:t,list_length:t.length},e)},n.reset_highlight=function(){n.setState({highlight_start:void 0,highlight_end:void 0})},n.on_save=function(){n.is_click_save=!0,j.a.variable.set_variable({variable_id:n.props.edit_list_dialog_setting.list_id,value:n.state.list_value.map((function(t){return Object(D.M)(t)})),edit_type:C.d.VALUE}),n.on_request_close()},n.on_list_increase=function(t){if(!(n.state.list_value.length>=O[1])){var e=n.state.list_value.concat();null!=n.state.selected_idx?e.splice(n.state.selected_idx+1,0,""):e.push(""),n.update_list(e,t)}},n.render_header=function(){return v.createElement("div",{className:"header--2-TqD"},n.get_intl_msg("dialog/edit_list_dialog/edit_list"))},n.handle_length_input_change=function(t){n.setState({list_length:String(n.get_valid_number(t.target.value,J[0],J[1]))})},n.handle_length_input_blur=function(t){var e=n.state,i=e.list_value,l=e.list_length;if(""!==l){var s=i.concat(),o=parseInt(l);if(o!==s.length){var _;if(n.is_enter_add_list&&(Object(w.m)("列表-回车添加列表项"),n.is_enter_add_list=!1),o>s.length)s=(_=s).concat.apply(_,a()(new Array(o-s.length).fill("")));else o<s.length&&s.splice(o,s.length-o);n.update_list(s)}}else n.setState({list_length:n.old_length})},n.handle_increase_btn_click=function(t){t.stopPropagation(),n.on_list_increase((function(){null!=n.state.selected_idx?n.change_focus(n.state.selected_idx+1):n.change_focus(n.state.list_value.length-1)}))},n.render_summary=function(){return v.createElement("div",{className:"summary--3Tj8k"},v.createElement("div",{className:"name--GYNa0"},n.state.list_name),v.createElement("div",{className:"length--30iG1"},v.createElement("div",{className:"count--3GmSv"},n.get_intl_msg("dialog/edit_list_dialog/list_count")),v.createElement("input",{maxLength:4,className:"th1-bg-9 length_input--13z9K",type:"text",pattern:"^[+]{0,1}(\\d+)$","data-report-click":"列表-编辑项数",onFocus:function(){n.old_length=n.state.list_value.length},value:n.state.list_length,onChange:n.handle_length_input_change,onBlur:n.handle_length_input_blur,onKeyDown:function(t){n.is_enter_add_list=!0,13===t.keyCode&&t.target.blur()}}),v.createElement(x.a,{type:"dark",width:28,height:28,on_click:n.handle_increase_btn_click,data_report:"列表-添加列表项"},v.createElement(x.c,{id:"#iconicon_add",size:12}))))},n.format_str=function(t){return t.replace(/\t/g,"  ").replace(/\r(\n)?/g,"\n")},n.handle_item_value_change=function(t,e){var i=n.state.list_value.concat();i[e]=n.format_str(t),n.setState({list_value:i})},n.on_item_input_focus=function(t){return function(){n.setState({selected_idx:t,editing_idx:t});var e=n.inputs[t];e&&(e.select(),e.parentElement&&Object(D.J)(e.parentElement))}},n.on_item_input_blur=function(){n.setState({editing_idx:void 0})},n.selection_move=function(t){return function(){var e=n.state.selected_idx;if(null!=e){if("up"===t){if(0===e)return;n.change_focus(--e)}else if("down"===t){if(e===n.state.list_value.length-1)return;n.change_focus(++e)}Object(w.m)("列表-".concat("up"===t?"向上键":"向下键"))}}},n.on_item_input_keydown=function(t){if(13===t.keyCode){if(n.state.list_value.length>=O[1])return;n.on_list_increase((function(){null!=n.state.selected_idx&&n.change_focus(n.state.selected_idx+1)}))}else 38===t.keyCode?(t.preventDefault(),n.selection_move(S.Up)()):40===t.keyCode&&(t.preventDefault(),n.selection_move(S.Down)())},n.handle_remove_list_item=function(t){return function(e){e.stopPropagation();var i=n.state.list_value.concat();i.splice(t,1),n.update_list(i,(function(){n.reset_highlight();var e=n.state,i=e.selected_idx,a=e.list_length;if(null!=i&&0!==a){var l=i;i===t?l=t===a?a-1:t:i>t&&(l=i-1),n.change_focus(l)}}))}},n.on_item_input_paste=function(t){if(t.clipboardData&&t.clipboardData.items){t.persist();var e=t.clipboardData.items[0];"string"===e.kind&&(Object(w.m)("列表-粘贴列表"),e.getAsString((function(e){var i=e.includes("\n"),l=n.state.editing_idx;if(i&&null!=l){t.preventDefault();var s=n.state.list_value.concat(),o=n.format_str(e).split("\n");s.splice.apply(s,[l,1].concat(a()(o))),n.update_list(s),n.setState({selected_idx:void 0,highlight_start:l,highlight_end:l+o.length-1}),n.inputs[l].blur()}})))}},n.render_list=function(){var t=n.state,e=t.selected_idx,i=t.editing_idx,a=t.highlight_start,l=t.highlight_end;return v.createElement(v.Fragment,null,n.state.list_value.map((function(t,s){var o=!1;null!=a&&void 0!==l&&(o=s>=a&&s<=l);var _=e===s,r=i===s,c=o?"th1-bg-7":"th1-bg-8";return r&&(c="th1-bg-9"),v.createElement("div",{key:s+1,className:("".concat(_?"th1-border-impt-0":""," ").concat(r?"th1-bg-8 th1-border-impt-0":"")?"".concat(_?"th1-border-impt-0":""," ").concat(r?"th1-bg-8 th1-border-impt-0":"")+" ":"")+h()("list_item ".concat(_?"selected":""," ").concat(r?"editing":""),G,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})},v.createElement("div",{className:(c?c+" ":"")+"idx--30fwI",onClick:function(t){n.setState({selected_idx:s})}},s+1),v.createElement("input",{className:(c?c+" ":"")+"value_input--w_Ot5",type:"text",value:String(t),"data-report-click":"列表-输入值",onFocus:n.on_item_input_focus(s),onChange:function(t){return n.handle_item_value_change(t.target.value,s)},onBlur:n.on_item_input_blur,onKeyDown:n.on_item_input_keydown,onPaste:n.on_item_input_paste,ref:n.add_input(s)}),v.createElement("div",{className:"remove_btn--27mGb","data-report-click":"列表-删除项",onClick:n.handle_remove_list_item(s)},v.createElement(x.c,{id:"#iconicon-delete",size:16,class_name:"th1-text-0 th1-text-s2"})))})))},n.render_empty_content=function(){return v.createElement("div",{className:"empty_content_container--2ff94"},v.createElement("div",{className:"content_label--2lCQd"},n.get_intl_msg("dialog/edit_list_dialog/empty_content")),v.createElement("div",{className:"tips--px3FR"},n.props.intl.formatMessage({id:"dialog/edit_list_dialog/tips"},{shortcut:Object(N.g)()?"Command + V":"Control + V"})))},n.render_details=function(){return v.createElement("div",{className:"th1-bg-9 details--2iihX",ref:function(t){n.content=t}},n.state.list_value.length>0?n.render_list():n.render_empty_content())},n.render_content=function(){return v.createElement("div",{className:"content--2ysfm"},n.render_summary(),n.render_details())},n.render_footer=function(){return v.createElement("div",{className:"footer--1BGmw"},v.createElement(x.a,{type:"primary",width:120,height:36,data_report:"列表-保存",on_click:n.on_save},n.get_intl_msg("dialog/edit_list_dialog/save")))},n.on_container_click=function(t){var e=t.target;n.reset_highlight(),["value_input","idx"].some((function(t){return e.className.includes(t)}))||n.setState({selected_idx:void 0,editing_idx:void 0})},n.on_document_paste=function(t){if(!(n.state.list_value.length>0)&&t.clipboardData&&t.clipboardData.items){var e=t.clipboardData.items[0];"string"===e.kind&&e.getAsString((function(t){var e=n.format_str(t).split("\n");n.update_list(e)}))}};var i=n.get_list_info(),l=i.name,o=i.value,_=i.length;return n.is_enter_add_list=!1,n.is_click_save=!1,n.state={list_name:l,list_value:o,list_length:_,selected_idx:void 0,editing_idx:void 0},n}return g()(e,t),_()(e,[{key:"componentDidMount",value:function(){document.addEventListener("paste",this.on_document_paste)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("paste",this.on_document_paste),this.props.set_dialog_props({edit_list_dialog_setting:void 0})}},{key:"get_valid_number",value:function(t,e,n){var i=parseInt(t);return i||0===i?(void 0!==e&&void 0!==n&&(i<e?i=e:i>n&&(i=n)),i):""}},{key:"render",value:function(){return v.createElement(E.a,{type:"edit_list",on_request_close:this.on_request_close.bind(this),close_btn:!0},v.createElement("div",{className:"container--3t2tJ",onClick:this.on_container_click},this.render_header(),this.render_content(),this.render_footer()))}}]),e}(v.Component);var q=Object(y.b)(Object(b.connect)((function(t){return{edit_list_dialog_setting:t.dialog_state.setting.edit_list_dialog_setting,variable_states:t.variable_state}}),(function(t){return Object(f.bindActionCreators)({close_dialog:k.c,set_dialog_props:k.f},t)}))(T))},kt7H:function(t,e,n){t.exports={container:"container--3t2tJ",header:"header--2-TqD",content:"content--2ysfm",summary:"summary--3Tj8k",summary_label:"summary_label--23H1T",length:"length--30iG1",count:"count--3GmSv",name:"name--GYNa0",length_input:"length_input--13z9K",details:"details--2iihX",empty_content_container:"empty_content_container--2ff94",content_label:"content_label--2lCQd",tips:"tips--px3FR",list_item:"list_item--3lDKb",selected:"selected--Zdjsf",editing:"editing--EpJlp",idx:"idx--30fwI",value_input:"value_input--w_Ot5",remove_btn:"remove_btn--27mGb",footer:"footer--1BGmw"}}}]);