(this.webpackJsonp=this.webpackJsonp||[]).push([[27],{"2skV":function(e,t,a){e.exports={avatar:"avatar--3BwjP",gif_cover:"gif_cover--4ezMr",avatar_editor_wrap:"avatar_editor_wrap--29kUQ",scale_bar:"scale_bar--ONgMs",change_cover:"change_cover--3m1FW",icon_wrap:"icon_wrap--1O2PI",zoom_button:"zoom_button--3K5ZN",zoom_in:"zoom_in--3vLTJ",zoom_out:"zoom_out--IAyID",cover_list:"cover_list--12fHB",upload_img:"upload_img--v8CRF",upload_img_input:"upload_img_input--awYlf",cover_list_wrap:"cover_list_wrap--2AENU",cover_list_section:"cover_list_section--3WeZp",title:"title--3ivWL",img_list:"img_list--3wudi",cover_img_wrap:"cover_img_wrap--wANAK",cover_img:"cover_img--3sVCp"}},"3KXy":function(e,t,a){"use strict";a.d(t,"f",(function(){return v})),a.d(t,"d",(function(){return w})),a.d(t,"c",(function(){return y})),a.d(t,"g",(function(){return M})),a.d(t,"b",(function(){return j})),a.d(t,"i",(function(){return N})),a.d(t,"h",(function(){return I})),a.d(t,"a",(function(){return S})),a.d(t,"e",(function(){return T}));var r,n=a("o0o1"),o=a.n(n),i=a("yXPU"),s=a.n(i),c=a("CR6n"),l=a("RShD"),u=a("bBeu"),_=a("ALsR"),p=a("5nG9"),d=a("WFO7"),h=a("e/E2"),m=a("q7c8");function g(e){return f.apply(this,arguments)}function f(){return(f=s()(o.a.mark((function e(t){var a,r,n=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.length>1&&void 0!==n[1]?n[1]:"GET",r=n.length>2&&void 0!==n[2]?n[2]:{url:t,method:a,withCredentials:!0},e.prev=2,e.next=5,Object(c.a)(r);case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0={};case 8:return e.abrupt("return",e.t0);case 11:throw e.prev=11,e.t1=e.catch(2),_.a.get_store().dispatch(Object(p.d)({content:"disconnect_tips",type:"error",timeout:2e3})),e.t1;case 15:case"end":return e.stop()}}),e,null,[[2,11]])})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=s()(o.a.mark((function e(t){var a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(Object(d.a)().creation_api,"/kitten/work/detail/").concat(t),e.next=3,g(a);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return k.apply(this,arguments)}function k(){return(k=s()(o.a.mark((function e(){var t,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(Object(d.a)().creation_api,"/kitten/work/labels"),e.next=3,g(t);case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return x.apply(this,arguments)}function x(){return(x=s()(o.a.mark((function e(){var t,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(Object(d.a)().creation_api,"/kitten/work/cover/defaultCovers"),e.next=3,g(t);case 3:return a=e.sent,e.abrupt("return",a.items);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return E.apply(this,arguments)}function E(){return(E=s()(o.a.mark((function e(t){var a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return a="".concat(Object(d.a)().creation_api,"/kitten/work/cover/").concat(t,"/recentCovers"),e.next=5,g(a);case 5:return r=e.sent,e.abrupt("return",r.items);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return O.apply(this,arguments)}function O(){return(O=s()(o.a.mark((function e(t){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){Object(l.a)(t,"cover",(function(t){e(t)}),!0).catch((function(e){console.error(e)}))}));case 2:return a=e.sent,e.abrupt("return",a.img?a.img:"");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t,a){return C.apply(this,arguments)}function C(){return(C=s()(o.a.mark((function e(t,a,n){var i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a||(a="image/jpg"),e.prev=1,i=new u.a,e.next=5,i.save_to_cdn(t,{file_type:a,bucket:"static",timeout:1e4,file_url_real_time:!0,upload_code:m.i.PROJECT_COVER,on_upload_progress:function(e){!n&&_.a.get_store().dispatch(Object(p.d)({content:"release_dialog/uploading_cover",type:"loading",timeout:!1,get_id:function(e){return r=e},on_close:function(){return r=void 0},disable_intl:!1}))},on_uploaded:function(){!n&&setTimeout((function(){r&&_.a.get_store().dispatch(Object(p.b)(r))}),1e3)}});case 5:return s=e.sent,e.abrupt("return",s);case 9:throw e.prev=9,e.t0=e.catch(1),r&&_.a.get_store().dispatch(Object(p.f)({id:r,content:"upload_error/network_error",type:"error",timeout:2e3,disable_intl:!1})),e.t0;case 13:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}function I(e){return P.apply(this,arguments)}function P(){return(P=s()(o.a.mark((function e(t){var a,r,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t,r="".concat(Object(d.a)().creation_api,"/kitten/r2/work/").concat(t.work_id,"/publish"),n={url:r,method:"PUT",data:a,withCredentials:!0},e.next=6,g(r,"PUT",n);case 6:L(t),e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function S(e){return R.apply(this,arguments)}function R(){return(R=s()(o.a.mark((function e(t){var a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,a="".concat(Object(d.a)().api.host,"/web/works/invite/recommend/").concat(t),r={url:a,method:"POST",data:{id:t},withCredentials:!0},e.next=7,g(a,"POST",r);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}function L(e){var t=e.labels,a=e.description,r=e.operation,n=e.fork_enable,o=e.cover_type;t.length&&Object(h.m)("发布-使用作品标签"),a&&Object(h.m)("发布-作品介绍"),r&&Object(h.m)("发布-操作说明"),1===n&&Object(h.m)("发布-允许购买"),0===n&&Object(h.m)("发布-不允许购买"),Object(h.m)(["发布-使用最近使用","发布-使用作品截图","发布-使用默认封面"][o])}function T(e){return D.apply(this,arguments)}function D(){return(D=s()(o.a.mark((function e(t){var a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(Object(d.a)().creation_api,"/collaboration/user/").concat(t),e.next=3,g(a);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},RDlg:function(e,t,a){e.exports={release_dialog:"release_dialog--1aj2C",title:"title--3Fmz3",content:"content--35dfJ",coll_publish_divider:"coll_publish_divider--2i43C",coll_publish_tips:"coll_publish_tips--3BIDu",success_container:"success_container--1_pVx",bg_pic:"bg_pic--1wGVb",bg_pic_book:"bg_pic_book--3mtUy",qr_image:"qr_image--1BBDe",success_tips:"success_tips--2-f7A",btn_container:"btn_container--2mXev",copy_work_url:"copy_work_url--3oyh1",jump_to_community:"jump_to_community--2Xe-4",content_left:"content_left--1MYIL",project_labels:"project_labels--25MxS",labels_wrap:"labels_wrap--2KCnl",label:"label--1w1O_",disable:"disable--VHqWz",content_right:"content_right--1Ukjd",work_name:"work_name--3iIZk",release_coll_bottom:"release_coll_bottom--1pFRy",textarea_wrap:"textarea_wrap--1kPqL",text:"text--2QnMx",release_coll_height:"release_coll_height--1hb4W",text_length_count:"text_length_count--rEcHH",control:"control--3HnUZ",release_coll_display:"release_coll_display--Is9py",fork_enable_check_list:"fork_enable_check_list--1d4V8","release-coll-user":"release-coll-user--LsiKs","release-coll-user-item":"release-coll-user-item--22rO1","release-coll-user-awator":"release-coll-user-awator--1ZjPP","release-coll-user-nickname":"release-coll-user-nickname--3PIQ5","release-coll-label-check":"release-coll-label-check--2HLGR","release-coll-user-scroll":"release-coll-user-scroll--11Umg",not_coll_user:"not_coll_user--2PVT6",release_button:"release_button--3Ra2f",coll_release_button:"coll_release_button--2yDaL",section_allow_forkable:"section_allow_forkable--3SfbK",allow_forkable_tip:"allow_forkable_tip--BtvGT",tip:"tip---1617",dot:"dot--3plhP",disable_style:"disable_style--2oLGZ",border_disable_style:"border_disable_style--rKNTi"}},VQJT:function(e,t,a){e.exports=function(e,t,a){"use strict";function r(e,t){return new Promise((function(a,r){var n,o=new Image;o.onload=function(){return a(o)},o.onerror=r,0==(null!==(n=e)&&!!n.match(/^\s*data:([a-z]+\/[a-z]+(;[a-z-]+=[a-z-]+)?)?(;base64)?,[a-z0-9!$&',()*+;=\-._~:@/?%\s]*\s*$/i))&&t&&(o.crossOrigin=t),o.src=e}))}e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,a=a&&a.hasOwnProperty("default")?a.default:a;var n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},c=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return a}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},l=function(e){var t=!1;return{promise:new Promise((function(a,r){e.then((function(e){return t?r({isCanceled:!0}):a(e)}),(function(e){return r(t?{isCanceled:!0}:e)}))})),cancel:function(){t=!0}}},u=!("undefined"==typeof window||"undefined"==typeof navigator||!("ontouchstart"in window||navigator.msMaxTouchPoints>0)),_="undefined"!=typeof File,p={touch:{react:{down:"onTouchStart",mouseDown:"onMouseDown",drag:"onTouchMove",move:"onTouchMove",mouseMove:"onMouseMove",up:"onTouchEnd",mouseUp:"onMouseUp"},native:{down:"touchstart",mouseDown:"mousedown",drag:"touchmove",move:"touchmove",mouseMove:"mousemove",up:"touchend",mouseUp:"mouseup"}},desktop:{react:{down:"onMouseDown",drag:"onDragOver",move:"onMouseMove",up:"onMouseUp"},native:{down:"mousedown",drag:"dragStart",move:"mousemove",up:"mouseup"}}},d=u?p.touch:p.desktop,h="undefined"!=typeof window&&window.devicePixelRatio?window.devicePixelRatio:1,m={x:.5,y:.5},g=function(e){function p(){var e,t,a;n(this,p);for(var r=arguments.length,o=Array(r),c=0;c<r;c++)o[c]=arguments[c];return t=a=s(this,(e=p.__proto__||Object.getPrototypeOf(p)).call.apply(e,[this].concat(o))),a.state={drag:!1,my:null,mx:null,image:m},a.handleImageReady=function(e){var t=a.getInitialSize(e.width,e.height);t.resource=e,t.x=.5,t.y=.5,a.setState({drag:!1,image:t},a.props.onImageReady),a.props.onLoadSuccess(t)},a.clearImage=function(){var e=a.canvas;e.getContext("2d").clearRect(0,0,e.width,e.height),a.setState({image:m})},a.handleMouseDown=function(e){(e=e||window.event).preventDefault(),a.setState({drag:!0,mx:null,my:null})},a.handleMouseUp=function(){a.state.drag&&(a.setState({drag:!1}),a.props.onMouseUp())},a.handleMouseMove=function(e){if(e=e||window.event,!1!==a.state.drag){e.preventDefault();var t=e.targetTouches?e.targetTouches[0].pageX:e.clientX,r=e.targetTouches?e.targetTouches[0].pageY:e.clientY,n={mx:t,my:r},o=a.props.rotate;if(o=(o%=360)<0?o+360:o,a.state.mx&&a.state.my){var s=a.state.mx-t,c=a.state.my-r,l=a.state.image.width*a.props.scale,u=a.state.image.height*a.props.scale,_=a.getCroppingRect(),p=_.x,d=_.y;p*=l,d*=u;var h=function(e){return e*(Math.PI/180)},m=Math.cos(h(o)),g=Math.sin(h(o)),f=d+-s*g+c*m,v={x:(p+s*m+c*g)/l+1/a.props.scale*a.getXScale()/2,y:f/u+1/a.props.scale*a.getYScale()/2};a.props.onPositionChange(v),n.image=i({},a.state.image,v)}a.setState(n),a.props.onMouseMove(e)}},a.setCanvas=function(e){a.canvas=e},s(a,t)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(p,t.Component),o(p,[{key:"componentDidMount",value:function(){this.props.disableHiDPIScaling&&(h=1);var e=a.findDOMNode(this.canvas).getContext("2d");if(this.props.image&&this.loadImage(this.props.image),this.paint(e),document){var t=!!function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(t){e=!1}return e}()&&{passive:!1},r=d.native;document.addEventListener(r.move,this.handleMouseMove,t),document.addEventListener(r.up,this.handleMouseUp,t),u&&(document.addEventListener(r.mouseMove,this.handleMouseMove,t),document.addEventListener(r.mouseUp,this.handleMouseUp,t))}}},{key:"componentWillReceiveProps",value:function(e){e.image&&this.props.image!==e.image||this.props.width!==e.width||this.props.height!==e.height?this.loadImage(e.image):e.image||this.clearImage()}},{key:"componentDidUpdate",value:function(e,t){var r=a.findDOMNode(this.canvas),n=r.getContext("2d");n.clearRect(0,0,r.width,r.height),this.paint(n),this.paintImage(n,this.state.image,this.props.border),e.image===this.props.image&&e.width===this.props.width&&e.height===this.props.height&&e.position===this.props.position&&e.scale===this.props.scale&&e.rotate===this.props.rotate&&t.my===this.state.my&&t.mx===this.state.mx&&t.image.x===this.state.image.x&&t.image.y===this.state.image.y||this.props.onImageChange()}},{key:"componentWillUnmount",value:function(){if(document){var e=d.native;document.removeEventListener(e.move,this.handleMouseMove,!1),document.removeEventListener(e.up,this.handleMouseUp,!1),u&&(document.removeEventListener(e.mouseMove,this.handleMouseMove,!1),document.removeEventListener(e.mouseUp,this.handleMouseUp,!1))}}},{key:"isVertical",value:function(){return this.props.rotate%180!=0}},{key:"getBorders",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.border;return Array.isArray(e)?e:[e,e]}},{key:"getDimensions",value:function(){var e=this.props,t=e.width,a=e.height,r=e.rotate,n=e.border,o={},i=this.getBorders(n),s=c(i,2),l=s[0],u=s[1],_=t,p=a;return this.isVertical()?(o.width=p,o.height=_):(o.width=_,o.height=p),o.width+=2*l,o.height+=2*u,{canvas:o,rotate:r,width:t,height:a,border:n}}},{key:"getImage",value:function(){var e=this.getCroppingRect(),t=this.state.image;e.x*=t.resource.width,e.y*=t.resource.height,e.width*=t.resource.width,e.height*=t.resource.height;var a=document.createElement("canvas");this.isVertical()?(a.width=e.height,a.height=e.width):(a.width=e.width,a.height=e.height);var r=a.getContext("2d");return r.translate(a.width/2,a.height/2),r.rotate(this.props.rotate*Math.PI/180),r.translate(-a.width/2,-a.height/2),this.isVertical()&&r.translate((a.width-a.height)/2,(a.height-a.width)/2),r.drawImage(t.resource,-e.x,-e.y),a}},{key:"getImageScaledToCanvas",value:function(){var e=this.getDimensions(),t=e.width,a=e.height,r=document.createElement("canvas");return this.isVertical()?(r.width=a,r.height=t):(r.width=t,r.height=a),this.paintImage(r.getContext("2d"),this.state.image,0,1),r}},{key:"getXScale",value:function(){var e=this.props.width/this.props.height,t=this.state.image.width/this.state.image.height;return Math.min(1,e/t)}},{key:"getYScale",value:function(){var e=this.props.height/this.props.width,t=this.state.image.height/this.state.image.width;return Math.min(1,e/t)}},{key:"getCroppingRect",value:function(){var e=this.props.position||{x:this.state.image.x,y:this.state.image.y},t=1/this.props.scale*this.getXScale(),a=1/this.props.scale*this.getYScale(),r={x:e.x-t/2,y:e.y-a/2,width:t,height:a},n=0,o=1-r.width,s=0,c=1-r.height;return(this.props.disableBoundaryChecks||t>1||a>1)&&(n=-r.width,o=1,s=-r.height,c=1),i({},r,{x:Math.max(n,Math.min(r.x,o)),y:Math.max(s,Math.min(r.y,c))})}},{key:"loadImage",value:function(e){var t;_&&e instanceof File?this.loadingImage=l((t=e,new Promise((function(e,a){var n=new FileReader;n.onload=function(t){try{var n=r(t.target.result);e(n)}catch(t){a(t)}},n.readAsDataURL(t)})))).promise.then(this.handleImageReady).catch(this.props.onLoadFailure):"string"==typeof e&&(this.loadingImage=l(r(e,this.props.crossOrigin)).promise.then(this.handleImageReady).catch(this.props.onLoadFailure))}},{key:"getInitialSize",value:function(e,t){var a=void 0,r=void 0,n=this.getDimensions();return n.height/n.width>t/e?r=e*((a=this.getDimensions().height)/t):a=t*((r=this.getDimensions().width)/e),{height:a,width:r}}},{key:"paintImage",value:function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h;if(t.resource){var n=this.calculatePosition(t,a);e.save(),e.translate(e.canvas.width/2,e.canvas.height/2),e.rotate(this.props.rotate*Math.PI/180),e.translate(-e.canvas.width/2,-e.canvas.height/2),this.isVertical()&&e.translate((e.canvas.width-e.canvas.height)/2,(e.canvas.height-e.canvas.width)/2),e.scale(r,r),e.globalCompositeOperation="destination-over",e.drawImage(t.resource,n.x,n.y,n.width,n.height),e.restore()}}},{key:"calculatePosition",value:function(e,t){e=e||this.state.image;var a=this.getBorders(t),r=c(a,2),n=r[0],o=r[1],i=this.getCroppingRect(),s=e.width*this.props.scale,l=e.height*this.props.scale,u=-i.x*s,_=-i.y*l;return this.isVertical()?(u+=o,_+=n):(u+=n,_+=o),{x:u,y:_,height:l,width:s}}},{key:"paint",value:function(e){e.save(),e.scale(h,h),e.translate(0,0),e.fillStyle="rgba("+this.props.color.slice(0,4).join(",")+")";var t=this.props.borderRadius,a=this.getDimensions(),r=this.getBorders(a.border),n=c(r,2),o=n[0],i=n[1],s=a.canvas.height,l=a.canvas.width;t=Math.max(t,0),t=Math.min(t,l/2-o,s/2-i),e.beginPath(),function(e,t,a,r,n,o){if(0===o)e.rect(t,a,r,n);else{var i=r-o,s=n-o;e.translate(t,a),e.arc(o,o,o,Math.PI,1.5*Math.PI),e.lineTo(i,0),e.arc(i,o,o,1.5*Math.PI,2*Math.PI),e.lineTo(r,s),e.arc(i,s,o,2*Math.PI,.5*Math.PI),e.lineTo(o,n),e.arc(o,s,o,.5*Math.PI,Math.PI),e.translate(-t,-a)}}(e,o,i,l-2*o,s-2*i,t),e.rect(l,0,-l,s),e.fill("evenodd"),e.restore()}},{key:"render",value:function(){var e=this.props,a=(e.scale,e.rotate,e.image,e.border,e.borderRadius,e.width,e.height,e.position,e.color,e.style),r=(e.crossOrigin,e.onLoadFailure,e.onLoadSuccess,e.onImageReady,e.onImageChange,e.onMouseUp,e.onMouseMove,e.onPositionChange,e.disableBoundaryChecks,e.disableHiDPIScaling,function(e,t){var a={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=e[r]);return a}(e,["scale","rotate","image","border","borderRadius","width","height","position","color","style","crossOrigin","onLoadFailure","onLoadSuccess","onImageReady","onImageChange","onMouseUp","onMouseMove","onPositionChange","disableBoundaryChecks","disableHiDPIScaling"])),n=this.getDimensions(),o={width:n.canvas.width,height:n.canvas.height,cursor:this.state.drag?"grabbing":"grab",touchAction:"none"},s={width:n.canvas.width*h,height:n.canvas.height*h,style:i({},o,a)};return s[d.react.down]=this.handleMouseDown,u&&(s[d.react.mouseDown]=this.handleMouseDown),t.createElement("canvas",i({ref:this.setCanvas},s,r))}}]),p}();return g.propTypes={scale:e.number,rotate:e.number,image:e.oneOfType([e.string].concat(function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}(_?[e.instanceOf(File)]:[]))),border:e.oneOfType([e.number,e.arrayOf(e.number)]),borderRadius:e.number,width:e.number,height:e.number,position:e.shape({x:e.number,y:e.number}),color:e.arrayOf(e.number),crossOrigin:e.oneOf(["","anonymous","use-credentials"]),onLoadFailure:e.func,onLoadSuccess:e.func,onImageReady:e.func,onImageChange:e.func,onMouseUp:e.func,onMouseMove:e.func,onPositionChange:e.func,disableBoundaryChecks:e.bool,disableHiDPIScaling:e.bool},g.defaultProps={scale:1,rotate:0,border:25,borderRadius:0,width:200,height:200,color:[0,0,0,.5],onLoadFailure:function(){},onLoadSuccess:function(){},onImageReady:function(){},onImageChange:function(){},onMouseUp:function(){},onMouseMove:function(){},onPositionChange:function(){},disableBoundaryChecks:!1,disableHiDPIScaling:!1},g}(a("17x9"),a("q1tI"),a("i8i4"))},foYB:function(e,t,a){"use strict";a.r(t),a.d(t,"ReleaseDialogComponent",(function(){return ce}));var r,n=a("o0o1"),o=a.n(n),i=a("yXPU"),s=a.n(i),c=a("RIqP"),l=a.n(c),u=a("lwsE"),_=a.n(u),p=a("W8MJ"),d=a.n(p),h=a("a1gu"),m=a.n(h),g=a("Nsbk"),f=a.n(g),v=a("PJYZ"),b=a.n(v),w=a("7W2i"),k=a.n(w),y=a("3WF5"),x=a.n(y),M=a("kNvX"),E=a.n(M),j=a("q1tI"),O=a("2OET"),N=a("/MKj"),C=a("ANjH"),I=a("FdHU"),P=a("4NMw"),S=a("WFO7"),R=a("CG87"),L=a("Gzrk"),T=a("G72A"),D=a("t5p7"),z=a("iqfz"),U=a("bdvc"),A=a("2pfL"),F=a("5nG9"),B=a("Vbab"),V=a("ryTQ"),H=a("utdV"),q=a("J+RK"),K=a("iTM4"),G=a("fylZ"),W=a("5IJ9"),X=a("re/r"),Z=a("lvvT"),J=a("ptQL"),Y=a("dqaR"),Q=a("VQJT"),$=a.n(Q),ee=a("3KXy");!function(e){e[e.recent=0]="recent",e[e.screen_shot=1]="screen_shot",e[e.default=2]="default"}(r||(r={}));var te=a("w0HH");a("2skV");var ae=function(e){function t(e){var a;return _()(this,t),(a=m()(this,f()(t).call(this,e))).file_input=void 0,a.cover_list=void 0,a.avatar_editor=void 0,a.init=s()(o.a.mark((function e(){var t,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ee.c)();case 2:return t=e.sent,e.next=5,Object(ee.g)(a.props.work_id);case 5:r=e.sent,a.setState({default_covers:t,recent_covers:r});case 7:case"end":return e.stop()}}),e)}))),a.handle_range_input_change=function(e){a.setState({range_input_value:e.target.value})},a.change_cover=function(e){a.state.show_cover_list||(a.setState({show_cover_list:e}),document.addEventListener("mousedown",a.on_window_mouse_down,!0))},a.on_window_mouse_down=function(e){var t=e.target;a.cover_list.contains(t)||"change_cover"===t.getAttribute("id")||a.hide_cover_list()},a.hide_cover_list=function(){a.setState({show_cover_list:!1}),document.removeEventListener("mousedown",a.on_window_mouse_down)},a.file_filter=function(){var e=s()(o.a.mark((function e(t){var r,n,i,s,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(U.o)([t]);case 2:if(r=e.sent,n=r.has_failed_load,i=r.has_oversize_img,s=r.has_unsupported_format,c="",n&&(c="release_dialog/invalid_image"),i&&(c="release_dialog/image_size_notice"),s&&(c="release_dialog/image_type_notice"),!c){e.next=11;break}return a.props.show_toast({content:c,type:"notice"}),e.abrupt("return",!1);case 11:return e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.load_img=function(){var e=s()(o.a.mark((function e(t){var r,n,i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.target.files){e.next=3;break}return e.abrupt("return");case 3:return n=r[0],e.next=6,a.file_filter(n);case 6:if(e.sent){e.next=9;break}return e.abrupt("return");case 9:i=URL.createObjectURL(n),s=!1,"image/gif"===n.type?(s=!0,a.setState({show_gif:!0,gif_url:i})):(s=!1,a.setState({show_gif:!1,gif_url:"",display_img:i})),a.hide_cover_list(),a.props.action_set_project_info_state({cover_is_gif:s,cover_url:i,updated_time:(new Date).getTime()});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handle_upload_img_click=function(){a.file_input.click()},a.handle_img_click=function(e){var t=e.indexOf("image/gif")>=0;t?a.setState({show_gif:t,gif_url:e}):a.setState({show_gif:!1,gif_url:"",display_img:e}),a.hide_cover_list(),a.props.action_set_project_info_state({cover_url:e,updated_time:(new Date).getTime()})},a.handle_zoom_button_click=function(e){var t;t="in"===e?1/8:-1/8;var r=parseFloat(a.state.range_input_value)+t;r<1&&(r=1),r>2&&(r=2);var n=r.toString();a.setState({range_input_value:n})},a.get_cover_info=s()(o.a.mark((function e(){var t,r,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.state.show_gif){e.next=7;break}return e.next=3,a.get_gif_base64_data(a.state.gif_url);case 3:r=e.sent,t=r,e.next=8;break;case 7:t=a.avatar_editor.getImageScaledToCanvas().toDataURL();case 8:return n=!1,(a.props.if_default_cover===te.a.Customized||1!=+a.state.range_input_value||a.state.display_img&&a.state.display_img!==a.props.preview)&&(n=!0),e.abrupt("return",{cover_base64_data:t,cover_type:a.state.cover_type,if_default_cover:n?te.a.Customized:te.a.Default});case 11:case"end":return e.stop()}}),e)}))),a.get_gif_base64_data=function(){var e=s()(o.a.mark((function e(t){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,a){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",r.onload=function(t){if(200===this.status){var a=this.response,r=new FileReader;r.onload=function(t){e(t.target.result)},r.readAsDataURL(a)}},r.send()}));case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.get_avatar=function(){var e=parseFloat(a.state.range_input_value),t=a.state.display_img?a.state.display_img:a.props.if_default_cover===te.a.Customized?a.props.cover_url:a.props.preview;if(t.indexOf("image/gif")>=0||a.state.show_gif&&a.state.gif_url){var r=a.state.gif_url?a.state.gif_url:t;return j.createElement("div",{className:"th1-border-impt-7 gif_cover--4ezMr",style:{backgroundImage:"url(".concat(r,")")}})}return j.createElement("div",{className:"th1-border-impt-7 avatar_editor_wrap--29kUQ"},j.createElement($.a,{crossOrigin:"anonymous",ref:function(e){e&&(a.avatar_editor=e)},image:t,width:362,height:362,border:0,scale:e}),j.createElement("div",{className:"scale_bar--ONgMs"},j.createElement("span",{className:"zoom_button--3K5ZN zoom_out--IAyID",onClick:a.handle_zoom_button_click.bind(b()(a),"out")},j.createElement("span",{className:"icon_wrap--1O2PI"},j.createElement(L.c,{id:"#icon_zoom_out",size:13}))),j.createElement("input",{type:"range",step:"0.01",min:"1",max:"2",value:a.state.range_input_value,onChange:a.handle_range_input_change}),j.createElement("span",{className:"zoom_button--3K5ZN zoom_in--3vLTJ",onClick:a.handle_zoom_button_click.bind(b()(a),"in")},j.createElement("span",{className:"icon_wrap--1O2PI"},j.createElement(L.c,{id:"#icon_zoom_in",size:13})))))},a.state={show_cover_list:!1,show_gif:a.props.cover_is_gif,gif_url:a.props.cover_url,range_input_value:"1",display_img:"",recent_covers:[],default_covers:[],cover_type:r.screen_shot},a}return k()(t,e),d()(t,[{key:"componentDidMount",value:function(){this.init(),this.props.get_avatar(this)}},{key:"render_cover_list_section",value:function(e){var t=this,a=this.props.intl.formatMessage({id:"release_dialog/".concat(e)}),r=[],n="";switch(e){case"recent_cover":r=this.state.recent_covers,n="发布-最近使用";break;case"screen_shot_cover":r.push(this.props.preview),n="发布-作品截图";break;default:r=this.state.default_covers,n="发布-默认图片"}return j.createElement("section",{className:"cover_list_section--3WeZp"},j.createElement("span",{className:"th1-text-t5 title--3ivWL"},a),j.createElement("div",{className:"img_list--3wudi"},r.map((function(e,a){return j.createElement("div",{className:"th1-border-impt-hover-0 cover_img_wrap--wANAK",key:a,onClick:t.handle_img_click.bind(t,e),"data-report-click":n},j.createElement("div",{className:"th1-border-impt-6 cover_img--3sVCp",style:{backgroundImage:"url(".concat(e,")")}}))}))))}},{key:"render",value:function(){var e=this;return j.createElement("div",{className:"avatar--3BwjP"},this.get_avatar(),j.createElement("span",{id:"change_cover",className:"th1-text-0 th1-text-hover-m2 th1-text-s2 change_cover--3m1FW",onClick:this.change_cover.bind(this,!0),"data-report-click":"发布-更改封面"},j.createElement("span",{className:"icon_wrap--1O2PI"},j.createElement(L.c,{id:"#icon_zaichuangzuo",size:16})),this.props.intl.formatMessage({id:"release_dialog/change_cover"})),this.state.show_cover_list&&j.createElement("div",{id:"cover_list",className:"cover_list--12fHB",ref:function(t){t&&(e.cover_list=t)}},j.createElement("div",{className:"th1-bg-6 th1-bg-hover-4 th1-text-0 th1-text-s2 upload_img--v8CRF",onClick:this.handle_upload_img_click,"data-report-click":"发布-上传"},this.props.intl.formatMessage({id:"release_dialog/upload_img"}),"/GIF"),j.createElement("input",{type:"file",className:"upload_img_input--awYlf",onChange:this.load_img,ref:function(t){t&&(e.file_input=t)},accept:".jpg, .jpeg, .png, .svg, .bmp, .gif"}),j.createElement("div",{className:"cover_list_wrap--2AENU"},this.state.recent_covers&&0!==this.state.recent_covers.length&&this.render_cover_list_section("recent_cover"),this.render_cover_list_section("screen_shot_cover"),this.render_cover_list_section("default_cover"))))}}]),t}(j.Component);var re,ne=Object(O.b)(Object(N.connect)((function(e){var t=e.project_state;return{preview:t.preview,work_id:t.work_id,cover_is_gif:t.cover_is_gif,cover_url:t.cover_url,if_default_cover:t.if_default_cover}}),(function(e){return Object(C.bindActionCreators)({close_dialog:T.c,show_toast:F.d,action_set_project_info_state:H.b},e)}))(ae)),oe=(a("RDlg"),{"./style.scss":{release_dialog:"release_dialog--1aj2C",title:"title--3Fmz3",content:"content--35dfJ",coll_publish_divider:"coll_publish_divider--2i43C",coll_publish_tips:"coll_publish_tips--3BIDu",success_container:"success_container--1_pVx",bg_pic:"bg_pic--1wGVb",bg_pic_book:"bg_pic_book--3mtUy",qr_image:"qr_image--1BBDe",success_tips:"success_tips--2-f7A",btn_container:"btn_container--2mXev",copy_work_url:"copy_work_url--3oyh1",jump_to_community:"jump_to_community--2Xe-4",content_left:"content_left--1MYIL",project_labels:"project_labels--25MxS",labels_wrap:"labels_wrap--2KCnl",label:"label--1w1O_",disable:"disable--VHqWz",content_right:"content_right--1Ukjd",work_name:"work_name--3iIZk",release_coll_bottom:"release_coll_bottom--1pFRy",textarea_wrap:"textarea_wrap--1kPqL",text:"text--2QnMx",release_coll_height:"release_coll_height--1hb4W",text_length_count:"text_length_count--rEcHH",control:"control--3HnUZ",release_coll_display:"release_coll_display--Is9py",fork_enable_check_list:"fork_enable_check_list--1d4V8","release-coll-user":"release-coll-user--LsiKs","release-coll-user-item":"release-coll-user-item--22rO1","release-coll-user-awator":"release-coll-user-awator--1ZjPP","release-coll-user-nickname":"release-coll-user-nickname--3PIQ5","release-coll-label-check":"release-coll-label-check--2HLGR","release-coll-user-scroll":"release-coll-user-scroll--11Umg",not_coll_user:"not_coll_user--2PVT6",release_button:"release_button--3Ra2f",coll_release_button:"coll_release_button--2yDaL",section_allow_forkable:"section_allow_forkable--3SfbK",allow_forkable_tip:"allow_forkable_tip--BtvGT",tip:"tip---1617",dot:"dot--3plhP",disable_style:"disable_style--2oLGZ",border_disable_style:"border_disable_style--rKNTi"}});(function(e){e[e.Programme=11]="Programme",e[e.Art=12]="Art",e[e.Sound=13]="Sound",e[e.Scheme=14]="Scheme",e[e.All=15]="All"})(re||(re={}));var ie=[{key:re.Programme,name:"编程"},{key:re.Art,name:"美术"},{key:re.Sound,name:"音效"},{key:re.Scheme,name:"策划"},{key:re.All,name:"全能"}],se=function(e){function t(e){var a;_()(this,t),(a=m()(this,f()(t).call(this,e))).avatar=void 0,a.name_input=void 0,a.intro_textarea=void 0,a.ipc_renderer=Object(J.a)(),a.get_avatar=function(e){a.avatar=e},a.on_request_close=function(){a.props.close_dialog({dialog_type:"release"})},a.handle_click_selection=function(e){a.props.action_set_project_info_state({fork_enable:e,updated_time:(new Date).getTime()})},a.handle_click_label=function(e){var t=l()(a.props.work_labels),r=t.indexOf(e);r>=0?t.splice(r,1):t.push(e),a.props.action_set_project_info_state({work_labels:t,updated_time:(new Date).getTime()})},a.handle_name_input_change=function(e){a.setState({current_work_name:e.target.value,disable_release_button:0===e.target.value.length})},a.handle_name_input_blur=function(e){var t=a.props.release_work_name||a.props.work_name,r=e.target.value;if(r!==t){var n=0===(r=a.get_validated_screen_name(r,t)).length;a.props.action_set_project_info_state({release_work_name:r,updated_time:(new Date).getTime()}),a.setState({current_work_name:r,disable_release_button:n})}},a.get_validated_screen_name=function(e,t){var r=Object(A.e)(e,t),n=r.name;return r.notice_content&&a.props.show_toast({content:r.notice_content,type:r.type}),n=Object(V.e)(n,t)},a.get_release_cover_url=function(){var e=s()(o.a.mark((function e(t){var a,r,n,i,s,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=/^data:(image\/[\s\S]*)?;base64,/,n=(a=t).match(r),i=n&&n[1],s=a,"image/gif"===i){e.next=10;break}return e.next=9,Object(ee.b)(a);case 9:s=e.sent;case 10:return e.next=12,Object(ee.i)(s,i);case 12:return c=e.sent,e.abrupt("return",c);case 16:throw e.prev=16,e.t0=e.catch(0),e.t0;case 20:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t){return e.apply(this,arguments)}}(),a.get_release_data=s()(o.a.mark((function e(){var t,r,n,i,s,c,l,u,_,p,d,h,m,g,f,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=a.props,r=t.release_work_name,n=t.operation_description,i=t.work_introduction,s=t.work_labels,c=t.fork_enable,l=t.publish_coll_list,u=t.is_coll_work,e.next=4,Object(q.a)(r||a.props.work_name,!1);case 4:return _=e.sent,e.next=7,a.avatar.get_cover_info();case 7:return p=e.sent,e.next=10,a.get_release_cover_url(p.cover_base64_data);case 10:return d=e.sent,(h=Object(W.generate_bcm)()).project_name=r,e.next=15,Object(X.h)(h,r);case 15:return m=e.sent,(g=Object(W.generate_bcmc)()).project_name=r,e.next=20,Object(X.i)(g,r);case 20:return f=e.sent,v=u?a.formatCollList(l):[],e.abrupt("return",{work_id:a.props.work_id,name:_,description:Object(U.R)(i)||a.props.intl.formatMessage({id:"release_dialog/default_introduction"}),operation:Object(U.R)(n)||a.props.intl.formatMessage({id:"release_dialog/default_operation"}),labels:s,cover_url:d,fork_enable:c,cover_type:p.cover_type,version:"4.11.7",user_labels:v,bcmc_url:f,work_url:m,if_default_cover:p.if_default_cover});case 25:throw e.prev=25,e.t0=e.catch(0),e.t0;case 29:case"end":return e.stop()}}),e,null,[[0,25]])}))),a.release=function(){var e=s()(o.a.mark((function e(t){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.state.is_release_button_enable){e.next=2;break}return e.abrupt("return");case 2:return a.setState({is_release_button_enable:!1}),e.prev=3,e.next=6,a.get_release_data();case 6:return r=e.sent,e.next=9,Object(ee.h)(r);case 9:return e.next=11,Object(ee.a)(r.work_id);case 11:if(Z.a.project.set_project_name(r.name),K.a.emit("publish_success"),a.props.action_set_project_info_state({published_status:1,work_id:r.work_id}),!Object(J.c)()){e.next=17;break}return a.setState({release_success:!0}),e.abrupt("return");case 17:a.on_request_close(),a.props.show_toast({content:a.props.published_status?"release_dialog/update_project_success":"release_dialog/release_project_success",type:"success",timeout:2e3}),t&&a.after_release_success(r.work_id||""),e.next=27;break;case 22:e.prev=22,e.t0=e.catch(3),K.a.emit("publish_error"),a.props.show_toast({content:"release_dialog/release_project_fail",type:"error",timeout:2e3}),a.setState({is_release_button_enable:!0});case 27:case"end":return e.stop()}}),e,null,[[3,22]])})));return function(t){return e.apply(this,arguments)}}(),a.handle_introduction_text_change=function(e){a.setState({introduction_text:e.target.value})},a.handle_operation_text_change=function(e){a.setState({operation_text:e.target.value})},a.text_change=function(e){"introduction"===e&&a.props.action_set_project_info_state({work_introduction:a.state.introduction_text,updated_time:(new Date).getTime()}),"operation"===e&&a.props.action_set_project_info_state({operation_description:a.state.operation_text,updated_time:(new Date).getTime()}),a.setState({is_edit_introduction:!1,is_edit_operation:!1})},a.change_textarea_edit_state=function(e,t){"introduction"===e?a.setState({is_edit_introduction:t}):a.setState({is_edit_operation:t})},a.get_disable_class=function(e){var t=a.props.work_labels,r=t.length>=3,n=t.indexOf(e)>=0;return r&&!n?"disable":""},a.get_content_left=function(){var e=a.state.labels,t=a.props.work_labels;return j.createElement("div",{className:"content_left--1MYIL"},j.createElement(ne,{get_avatar:a.get_avatar}),j.createElement("div",{className:"project_labels--25MxS"},j.createElement("title",{className:"th1-text-t7"},a.props.intl.formatMessage({id:"release_dialog/project_label"})),j.createElement("div",{className:"labels_wrap--2KCnl"},x()(e,(function(e){var r=t.length&&t.indexOf("".concat(e.id))>=0?"selected":"",n=a.get_disable_class(e.id.toString()),o=e.name[Object(B.e)()];return j.createElement("span",{key:e.id,onClick:a.handle_click_label.bind(b()(a),e.id.toString()),"data-report-click":"发布-作品标签",className:"th1-bg-8 th1-text-0 th1-bg-hover-6 th1-bg-selected-0 th1-text-selected-10  th1-text-s2 th1-text-selected-s1 ".concat(r)+" "+E()("label ".concat(n),oe,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})},o)})))))},a.get_content_right=function(){var e=a.props,t=e.fork_enable,r=e.is_coll_work,n=e.publish_coll_list,o=a.state.introduction_text.length?"th1-text-t7":"th1-text-t3",i=a.state.operation_text.length?"th1-text-t7":"th1-text-t3",s=a.state.is_edit_introduction?"":"th1-bg-8",c=a.state.is_edit_operation?"":"th1-bg-8",l=a.state.current_work_name.substring(0,20),u=r&&(null==n?void 0:n.length)>0;return j.createElement("div",{className:"content_right--1Ukjd"},j.createElement("title",{className:E()("work_name ".concat(r?"release_coll_bottom":""),oe,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})},a.props.intl.formatMessage({id:"release_dialog/work_name"}),j.createElement("span",{className:"dot--3plhP"})),j.createElement(D.a,{width:"428px",height:"40px",input_style:{border:"2px solid transparent"},classname:"th1-bg-8 th1-border-impt-hover-0 th1-border-impt-focus-0 th1-bg-focus-9 th1-text-t7 ".concat(a.state.is_editing_name?"th1-border-impt-0":""),value:l,on_change:a.handle_name_input_change,on_blur:a.handle_name_input_blur,get_input_el:function(e){a.name_input=e},max_length:20,margin:"0 0 20px"}),j.createElement("div",{className:"textarea_wrap--1kPqL"},j.createElement("title",{className:E()(r?"release_coll_bottom":"",oe,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})},a.props.intl.formatMessage({id:"release_dialog/description_title"})),j.createElement("textarea",{placeholder:a.props.intl.formatMessage({id:"release_dialog/introduction_placeholder"}),maxLength:200,value:a.state.introduction_text,onFocus:a.change_textarea_edit_state.bind(b()(a),"introduction",!0),onBlur:a.text_change.bind(b()(a),"introduction"),onChange:a.handle_introduction_text_change,className:("".concat(s," th1-border-impt-focus-0 th1-border-impt-hover-0 ").concat(o)?"".concat(s," th1-border-impt-focus-0 th1-border-impt-hover-0 ").concat(o)+" ":"")+E()("text ".concat(r?"release_coll_height":""),oe,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})}),j.createElement("span",{className:"th1-text-t5 text_length_count--rEcHH"},a.state.introduction_text.length,"/200")),j.createElement("div",{className:"textarea_wrap--1kPqL control--3HnUZ"},j.createElement("title",{className:E()(r?"release_coll_bottom":"",oe,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})},a.props.intl.formatMessage({id:"release_dialog/control_title"})),j.createElement("textarea",{placeholder:a.props.intl.formatMessage({id:"release_dialog/operation_placeholder"}),value:a.state.operation_text,maxLength:200,onFocus:a.change_textarea_edit_state.bind(b()(a),"operation",!0),onBlur:a.text_change.bind(b()(a),"operation"),onChange:a.handle_operation_text_change,className:("".concat(c," th1-border-impt-focus-0 th1-border-impt-hover-0 ").concat(i)?"".concat(c," th1-border-impt-focus-0 th1-border-impt-hover-0 ").concat(i)+" ":"")+E()("text ".concat(r?"release_coll_height":""),oe,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})}),j.createElement("span",{className:"th1-text-t5 text_length_count--rEcHH"},a.state.operation_text.length,"/200")),j.createElement("div",{className:"release_coll_display--Is9py"},j.createElement("title",{className:"th1-text-t7 section_allow_forkable--3SfbK"},a.props.intl.formatMessage({id:"release_dialog/allow_forkable"}),j.createElement("div",{className:"allow_forkable_tip--BtvGT"},j.createElement(L.c,{id:"#icon_chaxun",size:12}),j.createElement("div",{className:"tip---1617"},a.props.intl.formatMessage({id:"release_dialog/allow_forkable_tip"})))),j.createElement("div",{className:"fork_enable_check_list--1d4V8"},j.createElement("label",{className:"th1-border-impt-5 th1-border-impt-selected-0 ".concat(t?"selected":""," \n                ").concat(r?"":"th1-border-impt-hover-0"),onClick:a.handle_click_selection.bind(b()(a),1)},j.createElement("i",{className:"th1-bg-selected-0 ".concat(t?"selected":"")})),j.createElement("span",{className:"th1-text-t7"},a.props.intl.formatMessage({id:"release_dialog/fork_enable"})),j.createElement("label",{className:"th1-border-impt-5 th1-border-impt-hover-0 th1-border-impt-selected-0 ".concat(t?"":"selected"),onClick:a.handle_click_selection.bind(b()(a),0)},j.createElement("i",{className:"th1-bg-selected-0 ".concat(t?"":"selected")})),j.createElement("span",{className:"th1-text-t7"},a.props.intl.formatMessage({id:"release_dialog/fork_disable"})))),r&&j.createElement(j.Fragment,null,j.createElement("title",{className:"release_coll_bottom--1pFRy"},a.props.intl.formatMessage({id:"coll/release/user"})),u?j.createElement("div",{className:E()("release-coll-user ".concat(n.length>4?"release-coll-user-scroll":""),oe,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})},n.map((function(e,t){return j.createElement("div",{className:"release-coll-user-item--22rO1",style:{marginRight:t%2==1?"":"32px"},key:e.id},j.createElement("img",{className:"release-coll-user-awator--1ZjPP",src:e.avatar_url}),j.createElement("div",{className:"release-coll-user-nickname--3PIQ5"},e.nickname),j.createElement("div",{className:"release-coll-label-check--2HLGR"},j.createElement(z.a,{type:"transparent",height:"30px",width:"64px",border_radius:"4",on_click:a.getMenuPosition.bind(b()(a))},a.getLabelName(e.label||re.Programme),j.createElement(I.a,{dropdown:!0,size:12,id:"#cui_iconsanjiaoxing"}),j.createElement(L.e,{show:L.i.CLICK,position:{top:"".concat(a.state.menuTop,"px"),left:"".concat(a.state.menuLeft,"px")},mask:!0,items:ie.map((function(t){return{text:t.name,checked:e.label?t.key===+e.label:t.key===re.Programme,disable_intl:!0,on_click:function(){return a.handle_check_user_label(e.id,t.key)}}}))}))))}))):j.createElement("div",{className:"not_coll_user--2PVT6"},a.props.intl.formatMessage({id:"coll/not_coll_user"}))))};var r=a.props,n=r.work_name,i=r.release_work_name;return a.state={is_editing_name:!1,current_work_name:i||n,labels:[],disable_release_button:!1,avatar_img_url:"",introduction_text:a.props.work_introduction,operation_text:a.props.operation_description,is_edit_introduction:!1,is_edit_operation:!1,is_release_button_enable:!0,menuTop:0,menuLeft:0,release_success:!1},a}var a;return k()(t,e),d()(t,[{key:"componentDidMount",value:function(){this.init_dialog(),setTimeout(G.a,100)}},{key:"init_dialog",value:(a=s()(o.a.mark((function e(){var t,a,r,n,i,s,c,l,u,_,p,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.work_id){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Object(ee.f)(this.props.work_id);case 4:return t=e.sent,e.next=7,Object(ee.d)();case 7:return a=e.sent,r=t.name,n=t.cover_url,i=t.work_labels,s=t.fork_enable,c=t.work_introduction,l=t.operation_description,u=t.if_default_cover,_=1e3*t.published_time,e.next=12,Object(ee.e)(this.props.work_id);case 12:p=e.sent,this.props.action_set_project_info_state({publish_coll_list:p}),_>this.props.updated_time&&(this.props.action_set_project_info_state({release_work_name:r,cover_url:n,work_labels:i,fork_enable:this.props.is_coll_work?0:s,work_introduction:c,operation_description:l,updated_time:_,if_default_cover:u}),this.setState({introduction_text:c,operation_text:l})),d=n||this.props.preview,this.setState({labels:a,avatar_img_url:d});case 17:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"handle_check_user_label",value:function(e,t){for(var a=this.props.publish_coll_list.slice(),r=0;r<a.length;r++)if(+a[r].id==+e){a[r].label=t;break}this.props.action_set_project_info_state({publish_coll_list:a,updated_time:(new Date).getTime()})}},{key:"after_release_success",value:function(e){var t=this;if(!e)throw Error("NO work id after release");switch(this.props.after_release_project){case"jump_to_community":setTimeout((function(){var a="".concat(Object(S.a)().community,"/work/").concat(e,"?prevRouter=publish&published=").concat(!!Y.a.get_state().project_state.published_status);t.ipc_renderer?t.ipc_renderer.send("open-url",a):window.open(a)}),1e3);break;case"show_qr_code":this.on_request_close(),this.props.show_dialog({dialog_type:"qrcode"})}}},{key:"formatCollList",value:function(e){var t=[];return e&&e.forEach((function(e){t.push({id:e.id,label:e.label||re.Programme})})),t}},{key:"getLabelName",value:function(e){var t=ie.filter((function(t){return t.key===+e}))[0];return t&&t.name}},{key:"get_qr_image",value:function(){var e=P(5,"M");return e.addData("".concat(Object(S.a)().player,"/new/").concat(this.props.work_id)),e.make(),e.createSvgTag(3.55,0)}},{key:"copy_player_url",value:function(){var e=document.createElement("textarea");document.body.appendChild(e),e.value="".concat(Object(S.a)().player,"/new/").concat(this.props.work_id),e.select(),document.execCommand("copy")&&this.props.show_toast({content:"qrcode_share/copy_success",type:"success"}),document.body.removeChild(e)}},{key:"getMenuPosition",value:function(e){var t,a,r=null===(t=e.target)||void 0===t||null===(a=t.parentNode)||void 0===a?void 0:a.parentNode;if(r){var n=r.getBoundingClientRect().top,o=r.getBoundingClientRect().left;this.setState({menuTop:n-36*ie.length-15,menuLeft:o-30})}}},{key:"render",value:function(){var e=this;return j.createElement(R.a,{type:"release",on_request_close:this.on_request_close,close_btn:{style:{top:20,right:15,color:"#a5aebe"},icon_id:"#iconicon_close",icon_size:16}},j.createElement("div",{className:"release_dialog--1aj2C"},j.createElement("header",null,j.createElement("span",{className:"th1-text-t7 title--3Fmz3"},this.props.intl.formatMessage({id:this.props.published_status?"release_dialog/update_dialog_title":"release_dialog/release_dialog_title"}))),j.createElement("div",{className:"content--35dfJ"},this.state.release_success?j.createElement("div",{className:"success_container--1_pVx"},j.createElement("div",{className:"bg_pic--1wGVb"},j.createElement("div",{className:"bg_pic_book--3mtUy"}),j.createElement("div",{className:"qr_image--1BBDe",dangerouslySetInnerHTML:{__html:this.get_qr_image()}})),j.createElement("div",{className:"success_tips--2-f7A"},this.props.intl.formatMessage({id:"publish_dialog/app_publish_success"})),j.createElement("div",{className:"btn_container--2mXev"},j.createElement("div",{className:"copy_work_url--3oyh1",onClick:function(){return e.copy_player_url()}},j.createElement(L.c,{id:"#iconicon_fuzhi",margin:"0 6px 0 0",size:20}),this.props.intl.formatMessage({id:"publish_dialog/copy_link"})),j.createElement("div",{className:"jump_to_community--2Xe-4",onClick:function(){return window.open("".concat(Object(S.a)().community,"/work/").concat(e.props.work_id))}},j.createElement(L.c,{id:"#iconicn_project_link",size:32}),this.props.intl.formatMessage({id:"publish_dialog/app_open_community_player"})))):j.createElement(j.Fragment,null,this.get_content_left(),this.get_content_right(),this.props.is_coll_work&&j.createElement("div",{className:"coll_publish_divider--2i43C"}),j.createElement("span",{className:E()("release_button ".concat(this.props.is_coll_work?"coll_release_button":""),oe,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})},!!this.props.published_status&&!Object(J.c)()&&j.createElement(z.a,{type:"primary-outline",width:"145px",height:"36px",margin:"0 20px 0 0",disable:this.state.disable_release_button,on_click:function(){return e.release(!0)},data_report:this.state.is_release_button_enable?"更新-跳转到社区":""},this.state.is_release_button_enable?j.createElement("span",{style:{fontSize:14}},this.props.intl.formatMessage({id:"release_dialog/update_and_to_community"})):j.createElement(L.f,{size:18,theme_color:"0"})),j.createElement(z.a,{type:"primary",width:"120px",height:"36px",disable:this.state.disable_release_button,on_click:function(){return e.release(!e.props.published_status)},data_report:this.state.is_release_button_enable?"发布-确认发布":""},this.state.is_release_button_enable?j.createElement("span",{style:{fontSize:14}},this.props.intl.formatMessage({id:this.props.published_status?"release_dialog/confirm_update":"release_dialog/confirm_release"})):j.createElement(L.f,{size:18,theme_color:"10"})))))))}}]),t}(j.Component);var ce=Object(O.b)(Object(N.connect)((function(e){var t=e.project_state,a=t.work_name,r=t.preview,n=t.release_work_name,o=t.work_labels,i=t.cover_url,s=t.fork_enable,c=t.work_introduction,l=t.operation_description,u=t.published_status,_=t.updated_time,p=t.work_id,d=t.publish_coll_list,h=t.is_coll_work;return{work_id:p,work_name:a,preview:r,release_work_name:n,work_labels:o,cover_url:i,fork_enable:s,work_introduction:c,operation_description:l,published_status:u,updated_time:_,after_release_project:e.common_state.ui_cfg.after_release_project,publish_coll_list:d,is_coll_work:h}}),(function(e){return Object(C.bindActionCreators)({close_dialog:T.c,show_dialog:T.g,show_toast:F.d,action_set_project_info_state:H.b},e)}))(se))}}]);