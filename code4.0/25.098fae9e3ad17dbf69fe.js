(this.webpackJsonp=this.webpackJsonp||[]).push([[25],{"5WbA":function(i,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.inject_midi_function=void 0;var n=t("LvDl"),r=t("yx/L"),a=t("UVaV");e.inject_midi_function=function(i){var e=a.get_domain_functions(i),t=i.get_heart().get_registry(),u={on_midimusic_play_columns:{restart_when_finished:!0},on_midimusic_play_note:{restart_when_finished:!0}};n.forEach(e,(function(e,t){i.get_heart().get_registry().register({namespace:"",id:t,domain_function:e,metadata:u[t]})}));var o=r.get_events(i);n.forEach(o.get_action_specs(),(function(e){i.get_heart().get_registry().register_action_type({namespace:"",id:e.id,statefulness:e.statefulness}),e.responder_blocks.forEach((function(i){t.register({namespace:"",id:i.id,respond:{to_action:{namespace:"",id:e.id},type:i.type,async:i.async,priority:i.priority,entity_specific:e.entity_specific,trigger_function:i.trigger_function,filter_arg_names:i.filter_arg_names}})}))}))}},GMVE:function(i,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.get_midiMusics=e.get_midi_info=e.inject_runtime_data=void 0;var n,r=t("Bf/X"),a=new Map;e.inject_runtime_data=function(i){a=new Map,n=i;for(var e=0,t=i;e<t.length;e++){var u=t[e],o=u[0],_=u[1],s=u[2],c=u[3],m={id:_,name:o,midiMao:new r.MidiMao(s,{data:r.MidiMao.get_obb(s.obb),name:s.obb}).set_volume(null!=c?c:100)};a.set(_,m)}},e.get_midi_info=function(){return n},e.get_midiMusics=function(){return a}},IN4r:function(i,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NOTES=void 0,e.NOTES=["C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5","C6"]},UVaV:function(i,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.get_domain_functions=void 0;var n=t("LvDl"),r=t("Bf/X"),a=t("GMVE"),u=t("juHp"),o=t("IN4r"),_=t("yx/L");e.get_domain_functions=function(i){var e=i.get_heart().get_runtime_manager(),t=i.get_heart().get_runtime_data(),s={};function c(i){var e=a.get_midi_info();if(n.isNumber(i))return i<.5||Math.round(i)>=e.length+1||isNaN(i)?void console.log("over range"):e[(i=Math.round(i))-1][1];if(a.get_midiMusics().has(i))return i;var t=e.find((function(e){return e[0]===i}));return n.isArray(t)?t[1]:void console.log("please input right name")}function m(i,e){e&&a.get_midiMusics().forEach((function(i,e){m(i.id)})),s[i]&&(s[i].stop(),delete s[i])}function d(e,t,n){a.get_midiMusics().get(e).midiMao.register_event(r.MidiMaoEventType.PLAYING,(function(n,r,a,u){n.map((function(t,n){_.get_events(i).send_on_midimusic_play_note_action(e,t)})),_.get_events(i).send_on_midimusic_play_column_action(e,t,r.step)}))}function f(i){var e;null===(e=a.get_midiMusics().get(i))||void 0===e||e.midiMao.remove_all_event()}return{get_midis:function(i,e,t){return i.midimusic_id},get_whole_midis:function(i,e,t){return i.midimusic_id},get_any_midis:function(i,e,t){return i.midimusic_id},get_notes:function(i,e,t){return i.note},on_midimusic_play_note:function(i,e,r){var u=i.midimusic,s=function(i){return n.isString(i)?i:n.isNumber(i)&&1<=i&&i<=o.NOTES.length?o.NOTES[Math.round(i)-1]:void 0}(i.note);if(!s)return!1;if("any"===u)return a.get_midi_info().map((function(i,e){return i[1]})).some((function(i,e){return""!==t.get_action_state_value({action_id:_.MIDI_PLAY_NOTE_EVENT,action_namespace:"",sub_type:i+s})}));var m=c(u);return!!m&&""!==t.get_action_state_value({action_id:_.MIDI_PLAY_NOTE_EVENT,action_namespace:"",sub_type:m+s})},on_midimusic_play_columns:function(i,e,r){var a=i.midimusic,u=i.column_num;if(!n.isNumber(u))return!1;var o=c(a);if(!o)return!1;var s=t.get_action_state_value({action_id:_.MIDI_PLAY_COLUMN_EVENT,action_namespace:"",sub_type:o});if(""===s)return!1;try{var m=JSON.parse(s);return o===m.midi&&(m.step-m.start_step+1)%u==0}catch(i){console.error(i)}return!1},play_midimusic:function(i,e,t){var n=c(i.midimusic);n&&(d(n,0),u.midiPlayer.midiPlay(n,(function(){f(n)})))},play_midimusic_till_end:function(i,t,n){var r=c(i.midimusic);r&&(d(r,0),function(i,t,n){s[n]=e.get_thread_lock(i,t)}(n,t,r),u.midiPlayer.midiPlay(r,(function(){m(r)})))},stop_midimusic:function(i,e,t){var n=i.midimusic;if("all"===n)a.get_midiMusics().forEach((function(i){i.midiMao.remove_all_event()})),m(n,!0),u.midiPlayer.midiStop(n);else{var r=c(n);if(!r)return;f(r),m(r),u.midiPlayer.midiStop(r)}},set_midimusic_instrument:function(i,e,t){var n=i.midimusic,a=i.instrument,o=c(n);if(o){var _;switch(a){case"electric":_=r.InstrumentEnum.ELECTRIC;break;case"guitar":_=r.InstrumentEnum.GUITAR;break;case"piano":_=r.InstrumentEnum.PIANO;break;case"game":_=r.InstrumentEnum.GAME;break;case"dream":_=r.InstrumentEnum.DREAM;break;case"joker":_=r.InstrumentEnum.JOKER;break;default:_=r.InstrumentEnum.MIDI}u.midiPlayer.midiSetInstrument(o,_)}},set_midimusic_speed:function(i,e,t){var r=i.speed;!n.isNumber(r)||r<=0||!n.isFinite(r)||isNaN(r)||u.midiPlayer.midiSetGlobalSpeed(r>4?4:r)},play_midimusic_column:function(i,e,t){var o,_=i.midimusic,s=i.FROM,m=i.TO;if(!(!n.isNumber(s)||m&&!n.isNumber(m)||m&&n.isNumber(m)&&m<.5||s<.5||s>240)){var l=c(_);if(l){var g=n.round(s),p=m?n.round(m):m;1!==(null===(o=a.get_midiMusics().get(l))||void 0===o?void 0:o.midiMao.get_midi_info().state)&&(a.get_midiMusics().get(l).midiMao.register_event(r.MidiMaoEventType.END,(function(){f(l)})),d(l,g),u.midiPlayer.midiPlayNotes(l,g-1,p-1))}}},midimusic_column_tag:function(i,e,t){var r=i.TYPE,a=c(i.midimusic);if(!a)return[];switch(r){case"note":if(!n.isNumber(i.INDEX)||i.INDEX<.5||i.INDEX>240)return;var _=n.round(i.INDEX),s=u.midiPlayer.midiNotes(a,_-1).map((function(i){return e=i,o.NOTES.indexOf(e)+1;var e}));return 1===s.length?s[0]:s.reverse();case"beat":return u.midiPlayer.midiBeats(a);default:return[]}}}}},ggKk:function(i,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.midiPlayer=e.inject_runtime_data=e.inject_midi_function=void 0;var n=t("5WbA");Object.defineProperty(e,"inject_midi_function",{enumerable:!0,get:function(){return n.inject_midi_function}});var r=t("GMVE");Object.defineProperty(e,"inject_runtime_data",{enumerable:!0,get:function(){return r.inject_runtime_data}});var a=t("juHp");Object.defineProperty(e,"midiPlayer",{enumerable:!0,get:function(){return a.midiPlayer}})},juHp:function(i,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.midiPlayer=void 0;var n=t("Bf/X"),r=t("GMVE");e.midiPlayer={midiPlay:function(i,e){var t;return r.get_midiMusics().get(i).midiMao.register_event(n.MidiMaoEventType.END,(function(){e&&e()})),null===(t=r.get_midiMusics().get(i))||void 0===t?void 0:t.midiMao.play()},midiStop:function(i){var e;if("all"===i)return r.get_midiMusics().forEach((function(i,e){i.midiMao.stop()})),void r.get_midiMusics().forEach((function(i){i.midiMao.set_playback_rate(1)}));null===(e=r.get_midiMusics().get(i))||void 0===e||e.midiMao.stop()},midiSetInstrument:function(i,e){var t;null===(t=r.get_midiMusics().get(i))||void 0===t||t.midiMao.set_instrument(e)},midiSetGlobalSpeed:function(i){r.get_midiMusics().forEach((function(e){e.midiMao.set_playback_rate(i)}))},midiPlayNotes:function(i,e,t){var n;return(t&&e>t||e<0)&&console.warn("please reset range"),null===(n=r.get_midiMusics().get(i))||void 0===n?void 0:n.midiMao.play_part(e,t)},midiNotes:function(i,e){var t;if(!(e<0)){var n=[];return null===(t=r.get_midiMusics().get(i))||void 0===t||t.midiMao.get_pro_midi().tracks.forEach((function(i){var t=i.notes[e];t&&n.push(t.name)})),n}},midiBeats:function(i){var e,t=null===(e=r.get_midiMusics().get(i))||void 0===e?void 0:e.midiMao.get_midi_info();return Math.round(t.bpm*t.playback_rate)}}},"yx/L":function(i,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.get_events=e.MIDI_PLAY_COLUMN_EVENT=e.MIDI_PLAY_NOTE_EVENT=void 0,e.MIDI_PLAY_NOTE_EVENT="on_midimusic_play_note",e.MIDI_PLAY_COLUMN_EVENT="on_midimusic_play_columns",e.get_events=function(i){return{send_on_midimusic_play_note_action:function(t,n){i.get_heart().get_runtime_manager().send_action({id:e.MIDI_PLAY_NOTE_EVENT,namespace:"",parameters:void 0,sub_type:t+n,value:JSON.stringify({midi:t,note:n})})},send_on_midimusic_play_column_action:function(t,n,r){i.get_heart().get_runtime_manager().send_action({id:e.MIDI_PLAY_COLUMN_EVENT,namespace:"",parameters:void 0,sub_type:t,value:JSON.stringify({midi:t,start_step:n,step:r})})},get_action_specs:function(){return[{id:e.MIDI_PLAY_COLUMN_EVENT,entity_specific:!1,responder_blocks:[],statefulness:{default_value:"",automatic_transitions:"one_frame",use_sub_type:!0}},{id:e.MIDI_PLAY_NOTE_EVENT,entity_specific:!1,responder_blocks:[],statefulness:{default_value:"",automatic_transitions:"one_frame",use_sub_type:!0}}]}}}}}]);