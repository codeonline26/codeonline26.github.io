(this.webpackJsonp=this.webpackJsonp||[]).push([[58],{p2ky:function(e,t,o){e.exports={manage_toolbox_blocks_dialog:"manage_toolbox_blocks_dialog--2-4zB",content:"content--2Q14u",right:"right--1zks5",left:"left--2BY8N","toolbox-sidebar":"toolbox-sidebar--3pSPs",flex1:"flex1--206pl",h_flex:"h_flex--19HUO",v_center:"v_center--2YNx7",v_flex:"v_flex--29OWe",vh_center:"vh_center--3rvsn",h_start:"h_start--2ZWLN",h_end:"h_end--18iHd",h_center:"h_center--2wI-z",clickable:"clickable--7Ygfq",title:"title--3WEAL",footer:"footer--1BLSP","btn-wrap":"btn-wrap--34LJF","toolbox-item":"toolbox-item--3jLwB",disable:"disable--3l5wp","toolbox-item-content":"toolbox-item-content--3kZNF",selected:"selected--2lmhk","toolbox-name":"toolbox-name--2YzZE",invisible:"invisible--1bcMe","block-item":"block-item--3nsq9",appear:"appear--1jOYY",block:"block--K7-E1","block-img":"block-img--LI0dh",loading:"loading--2Y_1A"}},qlPC:function(e,t,o){"use strict";o.r(t),o.d(t,"ManageToolboxBlocksDialogComponent",(function(){return R}));var n=o("J4zp"),c=o.n(n),l=o("lSNA"),a=o.n(l),i=o("o0o1"),s=o.n(i),r=o("yXPU"),_=o.n(r),b=o("MVZn"),d=o.n(b),m=o("lwsE"),u=o.n(m),k=o("W8MJ"),g=o.n(k),p=o("a1gu"),x=o.n(p),f=o("Nsbk"),h=o.n(f),v=o("7W2i"),y=o.n(v),w=o("Y+p1"),E=o.n(w),O=o("BkRI"),j=o.n(O),N=o("kNvX"),B=o.n(N),M=o("q1tI"),S=o("ANjH"),Y=o("EVdn"),z=o("/MKj"),L=o("2OET"),W=o("G72A"),q=o("Gzrk"),A=o("0w0y"),I=o("Fye/"),C=o("WFO7"),F=o("INkv"),Z=o("/ZkB"),J=o("5xno"),P=o("S7bJ"),D=(o("p2ky"),o("XD4G")),H={"./style.scss":{flex1:"flex1--206pl",h_flex:"h_flex--19HUO",v_center:"v_center--2YNx7",v_flex:"v_flex--29OWe",vh_center:"vh_center--3rvsn",h_start:"h_start--2ZWLN",h_end:"h_end--18iHd",h_center:"h_center--2wI-z",clickable:"clickable--7Ygfq",disable:"disable--3l5wp",manage_toolbox_blocks_dialog:"manage_toolbox_blocks_dialog--2-4zB",title:"title--3WEAL",footer:"footer--1BLSP","btn-wrap":"btn-wrap--34LJF",content:"content--2Q14u",left:"left--2BY8N","toolbox-sidebar":"toolbox-sidebar--3pSPs","toolbox-item":"toolbox-item--3jLwB","toolbox-item-content":"toolbox-item-content--3kZNF",selected:"selected--2lmhk","toolbox-name":"toolbox-name--2YzZE",invisible:"invisible--1bcMe",right:"right--1zks5","block-item":"block-item--3nsq9",appear:"appear--1jOYY",block:"block--K7-E1","block-img":"block-img--LI0dh",loading:"loading--2Y_1A"}};var K=function(e){function t(e){var o;return u()(this,t),(o=x()(this,h()(t).call(this,e))).excluded_type=void 0,o.prev_toolbox_cfg=void 0,o.prev_blocks_cfg=void 0,o.real_mainworkspace=void 0,o.manage_toolbox_blocks_workspace=void 0,o.toolbox_text_data=void 0,o.toolbox_blocks_text=void 0,o.special_blocks=void 0,o.not_create_manage_workspace=function(){return Object.keys(o.props.images).length===Object.keys(o.state.hidden_toolbox_cfg).length},o.init_toolbox_indeterminate=function(){Object.keys(o.state.hidden_toolbox_cfg).forEach((function(e){var t=document.querySelector('input[id="'.concat(e,'"]')),n=o.state.hidden_blocks_cfg[e],c=Object.keys(n).some((function(e){return n[e]})),l=Object.keys(n).every((function(e){return n[e]}));t.indeterminate=!(l||!c)}))},o.set_current_toolbox=function(e){e!==o.state.current_toolbox&&(o.setState({current_toolbox:e}),setTimeout((function(){o.props.images[e]||o.set_workspace(e)}),20))},o.on_close=function(){o.props.close_dialog({dialog_type:"manage_toolbox_blocks"})},o.on_confirm=function(){var e=o.state.hidden_toolbox_cfg,t=o.state.hidden_blocks_cfg,n=Object.keys(e),c=n.filter((function(t){return!e[t]})),l=[];n.forEach((function(e){if(!c.includes(e)){var o=t[e];Object.keys(o).forEach((function(e){!1===o[e]&&l.push(e)}))}})),Object(Z.e)(c),Object(Z.d)(l),Object(P.i)(o.state.hidden_toolbox_cfg),Object(P.h)(o.state.hidden_blocks_cfg),o.props.close_dialog({dialog_type:"manage_toolbox_blocks"})},o.select_toolbox=function(e){var t=o.state.hidden_toolbox_cfg[e],n=document.querySelector('input[id="'.concat(e,'"]'));n.indeterminate&&(t=!1);var c=d()({},o.state.hidden_toolbox_cfg);c[e]=!t;var l=d()({},o.state.hidden_blocks_cfg);if(n.indeterminate=!1,t)for(var a in l[e])l[e][a]=!1;else for(var i in l[e])l[e][i]=!0;var s=o.is_cfg_changed(c,l);o.setState({hidden_toolbox_cfg:c,hidden_blocks_cfg:l,is_changed:s})},o.select_block=function(e){var t=o.state.hidden_blocks_cfg[o.state.current_toolbox][e],n=d()({},o.state.hidden_blocks_cfg);n[o.state.current_toolbox][e]=!t;var c=d()({},o.state.hidden_toolbox_cfg),l=document.querySelector('input[id="'.concat(o.state.current_toolbox,'"]'));t?Object.keys(n[o.state.current_toolbox]).some((function(e){return n[o.state.current_toolbox][e]}))?l.indeterminate=!0:(l.indeterminate=!1,c[o.state.current_toolbox]=!1):(c[o.state.current_toolbox]=!0,Object.keys(n[o.state.current_toolbox]).every((function(e){return n[o.state.current_toolbox][e]}))?l.indeterminate=!1:l.indeterminate=!0);var a=o.is_cfg_changed(c,n);o.setState({hidden_toolbox_cfg:c,hidden_blocks_cfg:n,is_changed:a})},o.set_workspace=function(){var e=_()(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.manage_toolbox_blocks_workspace.clear(),Blockly.xml.dom_to_workspace(Object(I.C)(Object(P.e)(o.toolbox_blocks_text[t]),!0),o.manage_toolbox_blocks_workspace),n=Blockly.mainWorkspace.get_all_blocks().filter((function(e){return!o.excluded_type.includes(e.type)})).map((function(e){return e.id})),e.next=5,o.get_block_image(t,n);case 5:o.manage_toolbox_blocks_workspace.clear();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o.get_block_image=function(){var e=_()(s.a.mark((function e(t,n){var c,l,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=[],l=0;case 2:if(!(l<n.length)){e.next=10;break}return e.next=5,Object(F.a)(n[l]);case 5:i=e.sent,c.push(i);case 7:l++,e.next=2;break;case 10:o.props.action_set_block_images({images:d()({},o.props.images,a()({},t,c))});case 11:case"end":return e.stop()}}),e)})));return function(t,o){return e.apply(this,arguments)}}(),o.get_toolbox_item=function(e){var t=c()(e,3),n=t[0],l=t[1],a=t[2];return M.createElement("div",{className:"toolbox-item--3jLwB",key:l,onClick:function(){return o.set_current_toolbox(n)}},M.createElement("input",{id:n,type:"checkbox",checked:o.state.hidden_toolbox_cfg[n],readOnly:!0}),M.createElement("label",{htmlFor:n,onClick:function(){return o.select_toolbox(n)}}),M.createElement("div",{className:B()("toolbox-item-content\n              ".concat(o.state.current_toolbox===n?"selected":"","\n              ").concat(o.state.hidden_toolbox_cfg[n]?"":"invisible"),H,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})},M.createElement(q.c,{size:36,id:"#".concat(a)}),M.createElement("div",{className:"toolbox-name--2YzZE"},l)))},o.get_toolbox_sidebar=function(){return M.createElement("div",{className:"toolbox-sidebar--3pSPs"},o.toolbox_text_data.map((function(e){return o.get_toolbox_item(e)})))},o.get_current_toolbox_blocks=function(e){return e&&o.toolbox_blocks_text?o.toolbox_blocks_text[e].map((function(t,n){return M.createElement("div",{key:t,className:"block-item--3nsq9"},M.createElement("input",{id:t,type:"checkbox",checked:o.state.hidden_blocks_cfg[e][t],readOnly:!0}),M.createElement("label",{htmlFor:t,onClick:function(){return o.special_blocks.includes(t)?void 0:o.select_block(t)},className:B()(o.special_blocks.includes(t)?"disable":"",H,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})}),M.createElement("div",{className:"block--K7-E1"},M.createElement("img",{src:o.props.images[e][n],onClick:function(){return o.special_blocks.includes(t)?void 0:o.select_block(t)},className:B()("block-img\n                ".concat(o.state.hidden_blocks_cfg[e][t]?"":"invisible","\n                ").concat(o.special_blocks.includes(t)?"disable":"","\n              "),H,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})})))})):null},o.get_content=function(){return M.createElement("div",{className:"content--2Q14u"},M.createElement("div",{className:"left--2BY8N"},o.get_toolbox_sidebar()),M.createElement("div",{className:"block-image right--1zks5"},o.props.images[o.state.current_toolbox]?o.get_current_toolbox_blocks(o.state.current_toolbox):M.createElement("div",{className:"loading--2Y_1A"},o.props.intl.formatMessage({id:"manage_toolbox_blocks/loading"}))))},o.get_footer=function(){return M.createElement("div",{className:"footer--1BLSP"},M.createElement("div",{className:"btn-wrap--34LJF"},M.createElement(q.a,{width:120,height:36,type:"primary-outline",on_click:o.on_close},M.createElement("span",{className:""},o.props.intl.formatMessage({id:"manage_toolbox_blocks/cancel"}))),M.createElement(q.a,{width:120,height:36,type:"primary",disable:!o.state.is_changed,on_click:o.on_confirm},M.createElement("span",{className:""},o.props.intl.formatMessage({id:"manage_toolbox_blocks/confirm"})))))},o.excluded_type=D.a,o.prev_toolbox_cfg=Object(P.b)(),o.prev_blocks_cfg=Object(P.a)(),o.toolbox_text_data=Object(P.d)(),o.toolbox_blocks_text=Object(P.c)(),o.special_blocks=Object(D.d)(),o.state={current_toolbox:A.a.events,hidden_toolbox_cfg:j()(o.prev_toolbox_cfg),hidden_blocks_cfg:j()(o.prev_blocks_cfg),is_changed:!1},o}return y()(t,e),g()(t,[{key:"componentDidMount",value:function(){var e=this;this.real_mainworkspace=Blockly.mainWorkspace,this.not_create_manage_workspace()||setTimeout((function(){e.manage_toolbox_blocks_workspace=Object(I.o)(".block-image",{media:Object(C.a)().blockly.media_path,zoom:{controls:!1,wheel:!1,scaleSpeed:1},readOnly:!0,disable:!0,tooltip:!1}),Y(".block-image .injectionDiv .blocklyMainBackground").remove(),Y(".block-image .injectionDiv").css("visibility","hidden"),Y(".block-image .injectionDiv").css("position","absolute"),e.set_workspace(e.state.current_toolbox),e.init_toolbox_indeterminate()}),0)}},{key:"componentWillUnmount",value:function(){Blockly.mainWorkspace=this.real_mainworkspace,Object(I.A)(),this.manage_toolbox_blocks_workspace&&this.manage_toolbox_blocks_workspace.dispose()}},{key:"is_cfg_changed",value:function(e,t){return!E()(this.prev_toolbox_cfg,e)||!E()(this.prev_blocks_cfg,t)}},{key:"render",value:function(){return M.createElement(q.g,{type:"manage_toolbox_blocks",on_request_close:this.on_close,close_btn:{icon_id:"#iconicon_close",style:{right:22,top:20},classname:"th1-text-t3 th1-text-hover-2 th1-text-active-0",icon_size:16}},M.createElement("div",{className:"manage_toolbox_blocks_dialog--2-4zB"},M.createElement("div",{className:"title--3WEAL"},this.props.intl.formatMessage({id:"manage_toolbox_blocks/title"})),this.get_content(),this.get_footer()))}}]),t}(M.Component);var R=Object(L.b)(Object(z.connect)((function(e){return{current_mode:e.switch_mode_dialog_states.current_mode,images:e.manage_toolbox_blocks_states.images}}),(function(e){return Object(S.bindActionCreators)({close_dialog:W.c,action_set_block_images:J.a},e)}))(K))}}]);