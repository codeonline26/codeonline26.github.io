(this.webpackJsonp=this.webpackJsonp||[]).push([[61],{"2Vly":function(e,t,r){e.exports={container:"container--12TZS",header:"header--13DGI",content:"content--10oap",status:"status--PCrH-",label:"label--1zdHf",pic:"pic--2hKZD",icon_outter_container:"icon_outter_container--NXmIM",icon_inner_container:"icon_inner_container--3KKYK",icon:"icon--5keK9",is_recording:"is_recording--FiYNx",is_playing:"is_playing--3Ot6g",has_recorded:"has_recorded--3sPKF",footer:"footer--ziFzU"}},qnxc:function(e,t,r){"use strict";r.r(t),r.d(t,"RecordingDialogComponent",(function(){return D}));var n=r("o0o1"),o=r.n(n),i=r("yXPU"),a=r.n(i),c=r("lwsE"),_=r.n(c),s=r("W8MJ"),d=r.n(s),l=r("a1gu"),g=r.n(l),u=r("Nsbk"),m=r.n(u),p=r("7W2i"),h=r.n(p),f=r("mNz5"),y=r.n(f),v=r("kNvX"),b=r.n(v),w=r("q1tI"),N=r("ANjH"),K=r("/MKj"),k=r("2OET"),O=r("G72A"),j=r("CG87"),E=r("iqfz"),x=r("cqq4"),z=r("yyi+"),I=r("bdvc"),S=r("mQNm"),M=r("5nG9"),q=r("e/E2"),P=(r("2Vly"),{"./style.scss":{container:"container--12TZS",header:"header--13DGI",content:"content--10oap",status:"status--PCrH-",label:"label--1zdHf",pic:"pic--2hKZD",icon_outter_container:"icon_outter_container--NXmIM",icon_inner_container:"icon_inner_container--3KKYK",icon:"icon--5keK9",is_recording:"is_recording--FiYNx",is_playing:"is_playing--3Ot6g",has_recorded:"has_recorded--3sPKF",footer:"footer--ziFzU"}});var C=function(e){function t(e){var r;return _()(this,t),(r=g()(this,m()(t).call(this,e))).timer_handler=void 0,r.max_time=60,r.start_count_down_time=10,r.last_recorded_time=0,r.last_recorded_id=y()(),r.is_complete_record_and_close=void 0,r.on_request_close=function(){r.is_complete_record_and_close?r.is_complete_record_and_close=!1:Object(q.m)("声音-退出录音"),z.AudioPlayerModule.stop_all_audio(),r.props.close_dialog({dialog_type:"recording"})},r.get_intl_msg=function(e){return r.props.intl.formatMessage({id:e})},r.start_recording=function(){r.setState({is_recording:!0,is_playing:!1,time_counter:0}),r.last_recorded_id=y()(),Object(x.c)().start_recording().catch((function(e){console.error(e),r.show_record_err_notice()})),r.timer_handler=setInterval(r.update_record_timer,1e3)},r.show_record_err_notice=function(){r.props.show_toast({content:"dialog/recording_dialog/fail_to_record",type:"error"})},r.stop_recording=function(){r.setState({has_recorded:!0,is_recording:!1}),clearInterval(r.timer_handler),Object(x.c)().stop_recording()},r.switch_recording_status=function(){r.state.is_recording?r.stop_recording():r.start_recording()},r.handle_record_btn_click=a()(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.stop_playing_audio(),!r.state.has_recorded){e.next=5;break}return r.setState({has_recorded:!1,time_counter:0}),r.last_recorded_time=0,e.abrupt("return");case 5:return e.prev=5,e.next=8,Object(x.d)();case 8:r.switch_recording_status(),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(5),console.log("init recorder fail: ".concat(e.t0));case 14:case"end":return e.stop()}}),e,null,[[5,11]])}))),r.update_record_timer=function(){var e=r.state.time_counter+1;r.setState({time_counter:e},(function(){r.last_recorded_time=r.state.time_counter})),e===r.max_time&&r.stop_recording()},r.update_playing_timer=function(){var e=r.state.time_counter-1;r.setState({time_counter:e}),0===e&&r.stop_playing_audio()},r.get_time_label=function(){var e=r.state,t=e.is_recording,n=e.time_counter;if(n<10)return"".concat("00:","0").concat(n);if(t&&n>=r.max_time-r.start_count_down_time){if("en"===r.props.intl.locale){var o=n>=1?r.get_intl_msg("dialog/recording_dialog/seconds"):r.get_intl_msg("dialog/recording_dialog/second");return"".concat(r.max_time-n," ").concat(o," ").concat(r.get_intl_msg("dialog/recording_dialog/tips_when_time_less_than_10s"))}return"".concat(r.get_intl_msg("dialog/recording_dialog/tips_when_time_less_than_10s")).concat(r.max_time-n).concat(r.get_intl_msg("dialog/recording_dialog/seconds"))}return"".concat("00:").concat(n)},r.play=function(){r.setState({is_playing:!0}),r.timer_handler=setInterval(r.update_playing_timer,1e3)},r.play_audio=a()(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(I.c)(Object(x.b)());case 2:t=e.sent,(n=z.AudioPlayerModule.load(r.last_recorded_id,t))&&("loaded"===n.state()&&(n.play(),r.play()),n.on("load",(function(){n.play(),r.play()})),n.on("loaderror",(function(e,t){})));case 5:case"end":return e.stop()}}),e)}))),r.stop_playing_audio=function(){r.setState({is_playing:!1,time_counter:r.last_recorded_time}),z.AudioPlayerModule.stop_all_audio(),clearInterval(r.timer_handler)},r.switch_playing_status=function(){if(r.state.has_recorded){if(!r.state.is_playing)return Object(q.m)("声音-播放录音"),void r.play_audio();Object(q.m)("声音-停止播放录音"),r.stop_playing_audio()}},r.on_save=function(){r.state.has_recorded&&(r.is_complete_record_and_close=!0,Object(S.f)(Object(x.b)(),Object(x.a)()).catch((function(e){console.error(e)})),r.on_request_close())},r.render_header=function(){return w.createElement("div",{className:"header--13DGI"},r.get_intl_msg("dialog/recording_dialog/record"))},r.render_content=function(){var e=r.state,t=e.is_playing,n=e.is_recording,o=e.has_recorded,i=(t?"is_playing":n&&"is_recording")||o&&"has_recorded"||"";return w.createElement("div",{className:"content--10oap"},w.createElement("div",{className:"status--PCrH-"},w.createElement("div",{className:"label--1zdHf"},r.get_time_label()),w.createElement("div",{className:"pic--2hKZD"},w.createElement("div",{onClick:r.switch_playing_status,className:b()("icon_outter_container ".concat(i),P,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})},w.createElement("div",{className:"icon_inner_container--3KKYK"},w.createElement("div",{className:"icon--5keK9"}))))))},r.render_footer=function(){var e=r.state,t=e.has_recorded,n=e.is_recording,o=t?"dialog/recording_dialog/restart_recording":"dialog/recording_dialog/start_recording";return w.createElement("div",{className:"footer--ziFzU"},w.createElement(E.a,{type:t?"primary-outline":"primary",width:120,height:36,on_click:r.handle_record_btn_click,data_report:"".concat(n?"声音-停止录音":t?"声音-重新录音":"声音-开始录音")},r.get_intl_msg(n?"dialog/recording_dialog/stop_recording":o)),w.createElement(E.a,{width:120,height:36,type:"primary",data_report:"声音-完成录音",on_click:r.on_save,disable:!r.state.has_recorded||r.state.is_recording},r.get_intl_msg("dialog/recording_dialog/finish")))},r.state={is_recording:!1,has_recorded:!1,is_playing:!1,time_counter:0},r.is_complete_record_and_close=!1,r}return h()(t,e),d()(t,[{key:"render",value:function(){return w.createElement(j.a,{type:"recording",on_request_close:this.on_request_close.bind(this),close_btn:!0},w.createElement("div",{className:"container--12TZS"},this.render_header(),this.render_content(),this.render_footer()))}}]),t}(w.Component);var D=Object(k.b)(Object(K.connect)(void 0,(function(e){return Object(N.bindActionCreators)({close_dialog:O.c,show_toast:M.d},e)}))(C))}}]);