(this.webpackJsonp=this.webpackJsonp||[]).push([[49],{nXy3:function(e,t,a){e.exports={popup_container:"popup_container--2kCCD",theme_item_container:"theme_item_container--1noHs",is_current_theme:"is_current_theme--3CxFw",theme_item:"theme_item--3fSOH",score:"score--2t9aM",clock:"clock--3VoGi",coin:"coin--1iRtz",pure:"pure--28GVI",HP:"HP--22QKt",common:"common--dmBtS",blue:"blue--1PhIi",green:"green--3mYci",purple:"purple--d2Ho-",red:"red--3VSkz",container:"container--27Z0q",header:"header--1rgCD",content:"content--1K8SK",footer:"footer--YEhCj",error_info:"error_info--3Dzm5",properties_container:"properties_container--ZWKeR",label:"label--s09tQ",properties_input:"properties_input--3K3CW",range:"range--1tcY4",global:"global--1Nkeu",entity:"entity--1aF4S",icon:"icon--1uEmX",range_label:"range_label--1Tf1T",selected:"selected--3ARRq",theme:"theme--jeXEs"}},qtWm:function(e,t,a){"use strict";a.r(t),a.d(t,"AddVariableDialogComponent",(function(){return M}));var n=a("lwsE"),i=a.n(n),r=a("W8MJ"),o=a.n(r),l=a("a1gu"),c=a.n(l),s=a("Nsbk"),_=a.n(s),d=a("7W2i"),m=a.n(d),u=a("kNvX"),p=a.n(u),g=a("q1tI"),b=a("ANjH"),h=a("/MKj"),v=a("2OET"),f=a("G72A"),E=a("CG87"),y=a("Gzrk"),k=a("iE9P"),N=a("mQNm"),C=a("cqy9"),S=a("lvvT"),w=a("HP1x"),K=a("7Cbv"),R=(a("nXy3"),{"./style.scss":{score:"score--2t9aM",clock:"clock--3VoGi",coin:"coin--1iRtz",pure:"pure--28GVI",HP:"HP--22QKt",common:"common--dmBtS",blue:"blue--1PhIi",green:"green--3mYci",purple:"purple--d2Ho-",red:"red--3VSkz",popup_container:"popup_container--2kCCD",theme_item_container:"theme_item_container--1noHs",is_current_theme:"is_current_theme--3CxFw",theme_item:"theme_item--3fSOH",container:"container--27Z0q",header:"header--1rgCD",content:"content--1K8SK",footer:"footer--YEhCj",error_info:"error_info--3Dzm5",properties_container:"properties_container--ZWKeR",label:"label--s09tQ",properties_input:"properties_input--3K3CW",range:"range--1tcY4",global:"global--1Nkeu",entity:"entity--1aF4S",icon:"icon--1uEmX",range_label:"range_label--1Tf1T",selected:"selected--3ARRq",theme:"theme--jeXEs"}});var j=function(e){function t(e){var a;return i()(this,t),(a=c()(this,_()(t).call(this,e))).name_input_el=void 0,a.get_input_el=function(e){a.name_input_el=e},a.get_intl_msg=function(e){return a.props.intl.formatMessage({id:e})},a.on_request_close=function(){a.props.close_dialog({dialog_type:"add_variable"})},a.on_confirm_btn=function(){var e=a.props.add_variable_dialog_setting,t=e.handle_confirmed_value,n=e.current_entity_id,i=K.a();t&&Object(C.b)().subscribe(C.a.NewVariable,{callback:function(){t(i)}},{once:!0});var r={id:i,type:a.is_list()?"list":"any",is_global:a.state.is_global,scale:1,visible:!0,theme:a.state.selected_theme,value:a.is_list()?[]:0,name:a.state.editing_name,offset:{x:0,y:0},position:Object(w.a)().get_next_cv_position(),current_entity:a.state.is_global?void 0:n};S.a.variable.add_variable(r),a.on_request_close()},a.is_list=function(){return"list"===a.props.add_variable_dialog_setting.type},a.render_header=function(){var e=a.get_intl_msg(a.is_list()?"dialog/add_variable_dialog/new_list":"dialog/add_variable_dialog/new_variable");return g.createElement("div",{className:"header--1rgCD"},e)},a.check_name_validality=function(e){var t=a.props.add_variable_dialog_setting,n=t.type,i=t.current_entity_id,r=Object(k.variable_name_validator)(e,"variable"===n,a.state.is_global,i);a.setState({name_error:r})},a.handle_name_input_change=function(e){var t=e.target.value;a.check_name_validality(t),a.setState({editing_name:t})},a.render_error_msg=function(){var e=a.state.name_error;return""!==e&&g.createElement("div",{className:"error_info--3Dzm5"},a.get_intl_msg(k.error_map[e]))},a.render_name=function(){return g.createElement("div",{className:"properties_container--ZWKeR"},g.createElement("div",{className:"label--s09tQ"},a.get_intl_msg("dialog/add_variable_dialog/name")),g.createElement("div",{className:"properties_input--3K3CW"},g.createElement(y.d,{autofocus:!0,margin:"6px",width:"100%",input_style:{paddingRight:"10px",borderColor:a.state.name_error?"#ff472e":void 0},placeholder:a.is_list()?"dialog/add_variable_dialog/variable_name_placeholder_list":"dialog/add_variable_dialog/variable_name_placeholder_variable",value:a.state.editing_name,on_change:a.handle_name_input_change,get_input_el:a.get_input_el,classname:"th1-bg-8 ".concat(""===a.state.name_error?"th1-border-impt-focus-0 th1-border-impt-hover-0":"")})))},a.set_global=function(e){a.setState({is_global:e},(function(){a.check_name_validality(a.state.editing_name)}))},a.render_range=function(){var e=a.is_list()?a.get_intl_msg("dialog/add_variable_dialog/type/list"):a.get_intl_msg("dialog/add_variable_dialog/type/variable"),t=a.state.is_global,n=a.props.add_variable_dialog_setting.current_entity_id,i=a.props,r=i.actors,o=i.scenes,l=Object(N.L)(r[n]&&r[n].current_style_id||o[n]&&o[n].current_style_id||"");return g.createElement("div",{className:"properties_container--ZWKeR"},g.createElement("div",{className:"label--s09tQ"},a.get_intl_msg("dialog/add_variable_dialog/property")),g.createElement("div",{className:"properties_input--3K3CW"},g.createElement("div",{className:"range--1tcY4"},g.createElement("div",{"data-report-click":"".concat(a.is_list()?"列表-新建全局列表":"变量-新建全局变量"),onClick:function(){return a.set_global(!0)},className:(t||"th1-bg-9 th1-border-impt-10"?(t?"th1-bg-8 th1-border-impt-0":"th1-bg-9 th1-border-impt-10")+" ":"")+p()("global ".concat(t?"selected":""),R,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})},g.createElement("div",{className:"icon--1uEmX"},a.is_list()?g.createElement(y.c,{id:"#iconicon_list",size:28}):g.createElement(y.c,{id:"#iconicon_quanjubianliang",size:28,color:"#212326"})),g.createElement("div",{className:"th1-text-t7 range_label--1Tf1T"},"".concat(a.get_intl_msg("dialog/add_variable_dialog/global")).concat(e))),g.createElement("div",{"data-report-click":"".concat(a.is_list()?"列表-新建角色列表":"变量-新建角色变量"),onClick:function(){return a.set_global(!1)},className:(t||"th1-bg-8 th1-border-impt-0"?(t?"th1-bg-9 th1-border-impt-10":"th1-bg-8 th1-border-impt-0")+" ":"")+p()("entity ".concat(t?"":"selected"),R,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})},g.createElement("div",{className:"icon--1uEmX",style:{backgroundImage:"url(".concat(l,")")}}),g.createElement("div",{className:"th1-text-t7 range_label--1Tf1T"},"".concat(a.get_intl_msg("dialog/add_variable_dialog/entity")).concat(e))))))},a.render_theme=function(){var e=a.is_list()?k.LIST_THEMES:k.VARIABLE_THEMES,t=function(e){return e===a.state.selected_theme};return g.createElement("div",{className:"properties_container--ZWKeR"},g.createElement("div",{className:"label--s09tQ"},a.get_intl_msg("dialog/add_variable_dialog/theme")),g.createElement("div",{className:"properties_input--3K3CW"},g.createElement("div",{className:"theme--jeXEs"},e.map((function(e,n){return g.createElement("div",{key:e,className:(t(e)||"th1-bg-9"?(t(e)?"th1-bg-7 th1-border-impt-0":"th1-bg-9")+" ":"")+p()("theme_item_container ".concat(t(e)?"selected":""),R,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})},g.createElement("div",{"data-report-click":"".concat(a.is_list()?"列表":"变量","-选择主题").concat(n+1),onClick:function(t){a.setState({selected_theme:e})},className:p()("theme_item ".concat(e),R,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})}))})))))},a.render_content=function(){return g.createElement("div",{className:"content--1K8SK"},a.render_name(),a.render_error_msg(),a.render_range(),a.render_theme())},a.render_footer=function(){return g.createElement("div",{className:"footer--YEhCj"},g.createElement(y.a,{type:"primary-outline",width:120,height:36,data_report:"".concat(a.is_list()?"列表":"变量","-取消新建"),on_click:a.on_request_close},a.get_intl_msg("cloud_variable/cancel")),g.createElement(y.a,{width:120,height:36,type:"primary",disable:!a.should_add_variable(),data_report:"".concat(a.is_list()?"列表":"变量","-确认新建"),on_click:a.on_confirm_btn},a.get_intl_msg("cloud_variable/confirm")))},a.should_add_variable=function(){return""!==a.state.editing_name&&""===a.state.name_error},a.handle_enter_down=function(e){a.should_add_variable()&&13===e.keyCode&&a.on_confirm_btn()},a.state={editing_name:"",is_global:!0,selected_theme:"common",name_error:""},a}return m()(t,e),o()(t,[{key:"componentDidMount",value:function(){this.name_input_el&&(this.name_input_el.focus(),this.name_input_el.addEventListener("keydown",(function(e){e.stopPropagation(),13===e.keyCode&&e.target.blur()}))),document.addEventListener("keydown",this.handle_enter_down)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handle_enter_down),this.props.set_dialog_props({add_variable_dialog_setting:void 0})}},{key:"render",value:function(){return g.createElement(E.a,{type:"add_variable",on_request_close:this.on_request_close.bind(this),close_btn:!0},g.createElement("div",{className:"container--27Z0q"},this.render_header(),this.render_content(),this.render_footer()))}}]),t}(g.Component);var M=Object(v.b)(Object(h.connect)((function(e){return{add_variable_dialog_setting:e.dialog_state.setting.add_variable_dialog_setting,actors:e.theatre_state.actors,scenes:e.theatre_state.scenes}}),(function(e){return Object(b.bindActionCreators)({close_dialog:f.c,set_dialog_props:f.f},e)}))(j))}}]);