(this.webpackJsonp=this.webpackJsonp||[]).push([[28],{"35m1":function(e,t,n){"use strict";n.r(t),n.d(t,"VideoPanelComponent",(function(){return H}));var i=n("lwsE"),o=n.n(i),a=n("W8MJ"),s=n.n(a),c=n("a1gu"),r=n.n(c),_=n("Nsbk"),l=n.n(_),d=n("7W2i"),p=n.n(d),u=n("1iNE"),m=n.n(u),v=n("P/G1"),h=n.n(v),b=n("q1tI"),f=n("2OET"),k=n("/MKj"),y=n("ANjH"),g=n("Gzrk"),x=n("L/I8"),w=n("SdoA"),j=n("G72A"),O=n("nP/6"),E=n("e/E2"),N=n("prAk"),M=n("1kS+"),A=n("3WF5"),B=n.n(A),C=n("Z88l"),S=n("MVZn"),U=n.n(S),W=n("kNvX"),D=n.n(W),X=n("V+57"),z=n("2pfL"),V=n("zTId"),G=n("6ETi"),F=n("lvvT"),I=n("UFrm"),L=n("CbrD"),T=(n("BLIe"),{"./style.scss":{video_container:"video_container--xsyo_",info_container:"info_container--vNtvG",info:"info--2yxSU",name_container:"name_container--3gJ2g",name:"name--xA9Xx",is_selected:"is_selected--1l2jh",name_input:"name_input--2ke_U",properties:"properties--34XMW",btn:"btn--AVGX9",visibility_keep:"visibility_keep--3RBcU",visibility:"visibility--UAMxq",delete:"delete--qaBpD",showing_input:"showing_input--3dLe8",duration_label:"duration_label--2a5RO",content:"content--aXo00"}});var q=function(e){function t(e){var n;return o()(this,t),(n=r()(this,l()(t).call(this,e))).input=void 0,n.input_max_length=20,n.is_db_click=void 0,n.prev_selected=void 0,n.click_count=void 0,n.coll_ui_container=void 0,n.remove_video=function(){0!==O.g.size&&(Object(O.c)(!0),n.props.show_toast({content:"video/video_panel/cancel_convert/notice",timeout:!1,get_id:function(e){return Object(L.b)(e)},type:"notice"}),n.props.hide_toast(O.a)),Object(E.m)("视频-删除"),Object(I.f)(n.props.id,I.c.Video)?I.b.warning((function(){return F.a.video.remove_video(n.props.id)})):F.a.video.remove_video(n.props.id)},n.set_visible=function(e){F.a.video.set_video_visible(e.id,!e.visible),Object(E.m)(e.visible?"视频-隐藏":"视频-显示")},n.on_focus_name=function(){n.input&&(n.input.value=n.input.value.slice(0,n.input_max_length))},n.on_change_name=function(e){n.setState({display_name:e.target.value})},n.on_blur_name=function(e){n.setState({show_name_input:!1}),e.stopPropagation();var t=n.props.name,i=n.input.value,o=Object(z.e)(i,t);i=Object(G.a)(o.name,t),n.is_db_click&&t!==i&&(Object(E.m)("视频-修改名称"),n.is_db_click=!1),n.input.value=i,o.notice_content&&n.props.show_toast({content:o.notice_content,type:o.type}),F.a.video.set_video_props(n.props.id,{name:i})},n.handle_context_menu=function(e){n.state.show_name_input||(n.on_click_video(n.props.id),n.props.show_context_menu({x:e.pageX,y:e.pageY,menu_items:[{text:"video/video_panel/modify_name",on_click:function(){n.setState({show_name_input:!0})},disable:!1}]}))},n.handle_input_enter=function(e){13===e.keyCode&&e.target.blur()},n.handle_mouse_down=function(){n.prev_selected=n.props.is_selected||!1},n.handle_mouse_up=function(e){if(2!==e.button){n.click_count+=1;var t=n.props.is_selected||!1;setTimeout((function(){1===n.click_count&&n.prev_selected&&t&&(n.is_db_click=!0,n.setState({show_name_input:!0})),n.click_count=0}),300)}},n.on_click_video=function(e){n.props.toggle_selected_id(e)},n.is_db_click=!1,n.state={show_name_input:!1,display_name:n.props.name||""},n}return p()(t,e),s()(t,[{key:"componentDidMount",value:function(){var e=this;Blockly.mainWorkspace&&Blockly.mainWorkspace.refresh_toolbox_selection(),Object(I.e)({elm_id:this.props.id,elm_type:I.c.Video,container:this.coll_ui_container,get_elm_state:function(){var t,n;return null!==(t=null===(n=e.props.coll_ui_state)||void 0===n?void 0:n.state)&&void 0!==t?t:"none"}})}},{key:"componentDidUpdate",value:function(e,t){t.show_name_input&&!this.state.show_name_input&&Blockly.mainWorkspace&&Blockly.mainWorkspace.refresh_toolbox_selection(),this.props.name!==e.name&&this.setState({display_name:this.props.name})}},{key:"render_bar",value:function(e){var t=this,n=e.name,i=this.state.show_name_input,o=e.sound_url||e.img_array||e.json_array;return b.createElement("div",{className:"info_container--vNtvG"},b.createElement("div",{className:"info--2yxSU"},b.createElement(g.c,{id:o?"#iconicon_shipinzhuanhua1":"#iconicon_shipin2",size:24,class_name:"th1-text-0"}),b.createElement("div",{className:"name_container--3gJ2g"},b.createElement("div",{onClick:this.handle_mouse_down,onMouseUp:this.handle_mouse_up,className:D()("name ".concat(this.props.is_selected?"is_selected":""),T,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})},n),i&&b.createElement("input",{autoFocus:!0,className:"th1-border-impt-0 th1-border-impt-focus-0 th1-bg-5 drag_disabled name_input--2ke_U",type:"text",maxLength:this.input_max_length,ref:function(e){return e&&(t.input=e)},onFocus:this.on_focus_name,onBlur:this.on_blur_name,onKeyDown:this.handle_input_enter,value:this.state.display_name,onChange:this.on_change_name}))),b.createElement("div",{className:D()("properties ".concat(i?"showing_input":"","\n          ").concat(this.props.is_selected?"is_selected":""),T,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})},b.createElement("div",{className:"btn--AVGX9 delete--qaBpD",onClick:this.remove_video},b.createElement(g.c,{id:"#iconicon-delete",size:16,class_name:"th1-text-0 th1-text-s2"})),b.createElement("div",{onClick:function(){t.set_visible(e)},className:D()("btn ".concat(e.visible?"visibility":"visibility_keep"),T,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})},b.createElement(g.c,{id:e.visible?"#iconxianshi1":"#iconyincang1",size:16,class_name:"th1-text-0 th1-text-s2"}))))}},{key:"render",value:function(){var e=this,t=this.state.show_name_input,n=this.props,i=n.id,o=n.videos,a=n.coll_ui_state;return b.createElement("div",{ref:function(t){return e.coll_ui_container=t},className:"th1-bg-hover-6 ".concat(t?"th1-bg-6":"th1-bg-8"," video_item\n          th1-bg-selected-5\n          ").concat(this.props.is_selected?"selected":"")+" video_container--xsyo_",onContextMenu:this.handle_context_menu,onClick:this.on_click_video.bind(this,this.props.id)},this.render_bar(o[i]),"others"===(null==a?void 0:a.state)?b.createElement(I.a,a):null)}}]),t}(b.Component);Object(I.i)((function(e){return e.id}),I.c.Video),Object(I.j)((function(e,t){return U()({},e,{current_audio:"",current_midi:"",current_variable:"",current_video:t,current_properties_panel:""})}),I.c.Video);var J=Object(I.k)(q,{type:I.c.Video}),R=Object(f.b)(Object(k.connect)((function(e){return{videos:e.theatre_state.videos}}),(function(e){return Object(y.bindActionCreators)({show_toast:x.g,hide_toast:x.e,show_context_menu:V.show_context_menu,action_set_video_uploading:X.action_set_video_uploading,action_set_video_property:X.action_set_video_property},e)}))(J));n("pMO3");var P=function(e){function t(e){var n;return o()(this,t),(n=r()(this,l()(t).call(this,e))).toggle_selected_id=function(e,t){n.setState({selected_id:e})},n.render_video_item_list=function(){var e=n.props.videos;return B()(e,(function(e){return b.createElement(R,{key:e.id,id:e.id,name:e.name,is_selected:n.state.selected_id===e.id,toggle_selected_id:n.toggle_selected_id})}))},n.state={selected_id:void 0},n}return p()(t,e),s()(t,[{key:"componentDidUpdate",value:function(e){"video"===e.current_toolbox_state.current_toolbox_name&&"video"!==this.props.current_toolbox_state.current_toolbox_name&&(Object(C.b)(e.current_toolbox_state.current_toolbox_name),this.setState({selected_id:""}))}},{key:"render",value:function(){return b.createElement("div",{className:"th1-border-impt-5 content--2d-dm"},this.render_video_item_list())}}]),t}(b.Component);var K=Object(f.b)(Object(k.connect)((function(e){return{current_toolbox_state:e.current_toolbox_state}}),{})(P));n("QTCz");var Q=function(e){function t(e){var n;return o()(this,t),(n=r()(this,l()(t).call(this,e))).render_btn=function(){var e=Object.keys(n.props.videos).length<1,t=!n.props.uploading&&e,i=t?"":"#A3AEBF";return b.createElement("div",{className:"add_video_btn--3cB_M",onClick:function(){Object(N.a)(),Object(E.m)("视频-添加视频")}},b.createElement(g.a,{type:"dark",width:"100%",height:28,disable:!t,bg_color:t?"":"#D7D8D9"},b.createElement(g.c,{id:"#iconicon_add",size:12,color:i}),b.createElement("span",{className:"add_btn_text--t-Apr",style:{color:i}},n.props.intl.formatMessage({id:"video"}))))},n.render_header=function(){return b.createElement(b.Fragment,null,b.createElement("div",{className:"header--3Esbp"},n.render_btn()))},n.render_content=function(){return b.createElement("div",{style:n.state.is_expanded?{}:{display:"none"}},b.createElement(K,{videos:h()(n.props.videos)}))},n.switch_tab=function(){Object(E.m)(n.state.is_expanded?"视频-收起视频管理":"视频-展开视频管理"),n.setState({is_expanded:!n.state.is_expanded})},n.state={is_expanded:!0},Object(O.b)(void 0),Object(O.c)(!1),n}return p()(t,e),s()(t,[{key:"componentDidMount",value:function(){Blockly.mainWorkspace&&Blockly.mainWorkspace.refresh_toolbox_selection()}},{key:"componentDidUpdate",value:function(e,t){var n=Object.keys(e.videos).length!==Object.keys(this.props.videos).length;(t.is_expanded!==this.state.is_expanded||n)&&Blockly.mainWorkspace&&Blockly.mainWorkspace.refresh_toolbox_selection()}},{key:"render",value:function(){return b.createElement("div",{className:"video_panel--Am515",id:this.props.id},this.render_header(),this.render_content(),b.createElement(g.h,{has_items:!!m()(this.props.videos),is_expanded:this.state.is_expanded,on_expand_btn_click:this.switch_tab}),b.createElement(M.a,{blockType:"has_sep"}))}}]),t}(b.Component);var H=Object(f.b)(Object(k.connect)((function(e){return{videos:e.theatre_state.videos,loader_state:e.loader_state,theme:e.common_state.theme,uploading:e.theatre_state.video_is_uploading}}),(function(e){return Object(y.bindActionCreators)({show_toast:x.g,hide_toast:x.e,update_toast:x.h,close_dialog:j.c,show_snackbar:w.show_snackbar,hide_snackbar:w.hide_snackbar},e)}))(Q))},BLIe:function(e,t,n){e.exports={video_container:"video_container--xsyo_",info_container:"info_container--vNtvG",info:"info--2yxSU",name_container:"name_container--3gJ2g",name:"name--xA9Xx",name_input:"name_input--2ke_U",is_selected:"is_selected--1l2jh",properties:"properties--34XMW",btn:"btn--AVGX9",visibility_keep:"visibility_keep--3RBcU",visibility:"visibility--UAMxq",delete:"delete--qaBpD",showing_input:"showing_input--3dLe8",duration_label:"duration_label--2a5RO",content:"content--aXo00"}},QTCz:function(e,t,n){e.exports={flyout_widget_item_container:"flyout_widget_item_container--3Jz_Q",video_panel:"video_panel--Am515",add_btn_text:"add_btn_text--t-Apr",header:"header--3Esbp",tab:"tab--1FWHY",label:"label--2M5Kq",expanded:"expanded--1jcLn",collapsed:"collapsed--14irF",add_video_btn:"add_video_btn--3cB_M",upload_file_input:"upload_file_input--OXpUt"}},pMO3:function(e,t,n){e.exports={content:"content--2d-dm"}}}]);