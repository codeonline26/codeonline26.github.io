(this.webpackJsonp=this.webpackJsonp||[]).push([[48],{CO73:function(e,t,a){e.exports={project_lists:"project_lists--2SQua",wrapper:"wrapper--1SBaf",flex1:"flex1--2KOJ4",h_flex:"h_flex--1BNkI",v_center:"v_center--1UGRo",v_flex:"v_flex--1PfYL",vh_center:"vh_center--2tjNb",h_start:"h_start--3uE6r",h_end:"h_end--d72zi",h_center:"h_center--3N0P1",clickable:"clickable--3ZCGF",confirm:"confirm--lOC4Y",dialog:"dialog--2e3AK",content:"content--2geLH",showDialog:"showDialog--1Jqiz","wrapper--appear--active":"wrapper--appear--active--2adG-","wrapper--appear":"wrapper--appear--1Ganh",mask:"mask--3qcBj",material:"material--n8INI",showMask:"showMask--3daCb",dialog_btn_close:"dialog_btn_close--szvd3",common_dialog:"common_dialog--3SKZN",title:"title--3BVn9",sub_title:"sub_title--H6O3d","single-illustration":"single-illustration--37bkx",description:"description--3j-PC",btn_group:"btn_group--3ORSb",btn:"btn--1iKLI",negative:"negative--d3lUW",left:"left--2gR9D",header:"header--2iZTu",close_btn:"close_btn--Sbf7W",dialog_style:"dialog_style--1f4Sz",positive:"positive--3jp3-",common_input:"common_input--18-9T",container:"container--3zgME","header-title":"header-title--3dlz0","cloud-info-wrap":"cloud-info-wrap--2cC4R",current_project_title:"current_project_title--FpIzo",cloud_info_content:"cloud_info_content--36Ew0",data_category:"data_category--3T2nF","info-1":"info-1--MULqs","info-2":"info-2--LTdVz",icon:"icon--2eZ6d",capacity_num:"capacity_num--1RVeQ",clear_btn_wrap:"clear_btn_wrap--1mJBJ",clear_btn:"clear_btn--30osr",clear_btn_useless:"clear_btn_useless--14Fey",project:"project--2pzgU",project_info:"project_info--2cLc5",project_name:"project_name--7pYPb",project_data_sum:"project_data_sum--1gdiR","project-img":"project-img--UkqdU","project-img-border":"project-img-border--1MQNQ",current_project_n_variables:"current_project_n_variables--34AGF",tooltip:"tooltip--1BMcK",user_info_list:"user_info_list--2urW4","server-capacity":"server-capacity--2VeEy","data-size-bar":"data-size-bar--2J0Bx","data-size-occupied":"data-size-occupied--myHF4","server-capacity-refresh":"server-capacity-refresh--YzbGH",tips:"tips--39kYG",chart_sample:"chart_sample--njHMG",icn_color:"icn_color--1pD20",purple:"purple--f0IYA",pink:"pink--1y8He",yellow:"yellow--11H5u",subtitle:"subtitle--2Gf9T",subtitle_2:"subtitle_2--3imCu",n_players:"n_players--2tQmE"}},rC6X:function(e,t,a){"use strict";a.r(t),a.d(t,"CloudManagerDialogComponent",(function(){return O}));var r=a("o0o1"),i=a.n(r),c=a("yXPU"),o=a.n(c),n=a("lwsE"),s=a.n(n),l=a("W8MJ"),_=a.n(l),p=a("a1gu"),d=a.n(p),u=a("Nsbk"),m=a.n(u),h=a("7W2i"),g=a.n(h),v=a("3WF5"),b=a.n(v),f=a("1iNE"),y=a.n(f),j=a("kNvX"),k=a.n(j),E=a("q1tI"),w=a("2OET"),x=a("/MKj"),N=a("ANjH"),M=a("CG87"),z=a("5nG9"),C=a("bdvc"),L=a("HP1x"),I=a("G72A"),H=a("Gzrk"),F=a("X8LL"),S=a("i3Cl"),G=a("qziI"),B=a("yCyL"),T=(a("CO73"),{"./style.scss":{flex1:"flex1--2KOJ4",h_flex:"h_flex--1BNkI",v_center:"v_center--1UGRo",v_flex:"v_flex--1PfYL",vh_center:"vh_center--2tjNb",h_start:"h_start--3uE6r",h_end:"h_end--d72zi",h_center:"h_center--3N0P1",clickable:"clickable--3ZCGF",wrapper:"wrapper--1SBaf",confirm:"confirm--lOC4Y",dialog:"dialog--2e3AK",content:"content--2geLH",showDialog:"showDialog--1Jqiz","wrapper--appear--active":"wrapper--appear--active--2adG-","wrapper--appear":"wrapper--appear--1Ganh",mask:"mask--3qcBj",material:"material--n8INI",showMask:"showMask--3daCb",dialog_btn_close:"dialog_btn_close--szvd3",common_dialog:"common_dialog--3SKZN",title:"title--3BVn9",sub_title:"sub_title--H6O3d","single-illustration":"single-illustration--37bkx",description:"description--3j-PC",btn_group:"btn_group--3ORSb",btn:"btn--1iKLI",negative:"negative--d3lUW",left:"left--2gR9D",dialog_style:"dialog_style--1f4Sz",positive:"positive--3jp3-",common_input:"common_input--18-9T",container:"container--3zgME",header:"header--2iZTu","header-title":"header-title--3dlz0",close_btn:"close_btn--Sbf7W","cloud-info-wrap":"cloud-info-wrap--2cC4R",current_project_title:"current_project_title--FpIzo",cloud_info_content:"cloud_info_content--36Ew0",data_category:"data_category--3T2nF","info-1":"info-1--MULqs","info-2":"info-2--LTdVz",icon:"icon--2eZ6d",capacity_num:"capacity_num--1RVeQ",clear_btn_wrap:"clear_btn_wrap--1mJBJ",clear_btn:"clear_btn--30osr",clear_btn_useless:"clear_btn_useless--14Fey",project_lists:"project_lists--2SQua",project:"project--2pzgU",project_info:"project_info--2cLc5",project_name:"project_name--7pYPb",project_data_sum:"project_data_sum--1gdiR","project-img":"project-img--UkqdU","project-img-border":"project-img-border--1MQNQ",current_project_n_variables:"current_project_n_variables--34AGF",tooltip:"tooltip--1BMcK",user_info_list:"user_info_list--2urW4","server-capacity":"server-capacity--2VeEy","data-size-bar":"data-size-bar--2J0Bx","data-size-occupied":"data-size-occupied--myHF4","server-capacity-refresh":"server-capacity-refresh--YzbGH",tips:"tips--39kYG",chart_sample:"chart_sample--njHMG",icn_color:"icn_color--1pD20",purple:"purple--f0IYA",pink:"pink--1y8He",yellow:"yellow--11H5u",subtitle:"subtitle--2Gf9T",subtitle_2:"subtitle_2--3imCu",n_players:"n_players--2tQmE"}});var U;!function(e){e.N_PUBLIC_CV="n_public_variables",e.N_PRIVATE_CV="n_private_variables",e.N_PUBLIC_LIST="n_public_lists"}(U||(U={}));var R=function(e){function t(e){var a;return s()(this,t),(a=d()(this,m()(t).call(this,e))).current_page=1,a.project_list_wrap=void 0,a.is_fetching_project=!1,a.all_projects_fetched=!1,a.expand_capacity_clicked=!1,a.get_intl_msg=function(e){return a.props.intl.formatMessage({id:e})},a.state={data_size:3e3,selected_project_id:"",clear_dialog_state:!1},a}var a,r;return g()(t,e),_()(t,[{key:"componentDidMount",value:function(){var e=this;this.props.work_id&&this.props.fetch_project_info(this.props.work_id);var t={id:this.props.work_id||"",preview:"",name:this.props.work_name,n_variables:0};Object(L.a)().screenshot(void 0,.3).then((function(a){t.preview=a,e.props.update_project(t)})).then((function(){e.on_project_list_scroll()})).catch((function(e){return console.error(e)})),this.props.fetch_summary_info()}},{key:"componentDidUpdate",value:function(e){var t=this.props.cloud_manager_state.cloud_projects,a=e.cloud_manager_state.cloud_projects;if(y()(t)!==y()(a))return 0===y()(a)&&this.setState({selected_project_id:t[Object.keys(t)[0]].id.toString()}),!0}},{key:"on_request_close",value:function(){this.props.close_dialog({dialog_type:"cloud_manager"}),this.props.clear_dashboard()}},{key:"on_project_click",value:function(e,t){Object(C.J)(t.target),this.props.fetch_project_info(e),this.setState({selected_project_id:e.toString()})}},{key:"on_refresh_click",value:(r=o()(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.props.summary_info_correction();case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"on_project_img_load",value:function(e){var t=e.target;t.width>t.height?(t.style.maxHeight="100%",t.style.maxWidth=""):(t.style.maxWidth="100%",t.style.maxHeight="")}},{key:"on_project_list_scroll",value:function(){var e=this;if(!this.is_fetching_project&&!this.all_projects_fetched){var t=this.project_list_wrap;Math.abs(t.clientHeight+t.scrollTop-t.scrollHeight)>=5||(this.is_fetching_project=!0,this.props.fetch_projects({page:this.current_page,limit:12,on_success:function(t){e.current_page++,e.is_fetching_project=!1,e.all_projects_fetched=t}}))}}},{key:"on_clear_btn_click",value:function(e){var t=this;e?this.props.set_dialog_props({confirm_dialog_setting:{title:"cloud_manager/confirm/delete_title",tip:"cloud_manager/confirm/delete_tip",btn_right:{text:"cloud_manager/cleardata",type:"danger",callback:function(){Object(C.B)()?(t.props.action_delete_private_variables_data(t.state.selected_project_id),t.props.close_dialog({dialog_type:"confirm"})):t.props.show_toast({content:"bad_network_notice",type:"error"})}},btn_left:{text:"cloud_variable/cancel",callback:function(){t.props.close_dialog({dialog_type:"confirm"})}}}}):this.props.set_dialog_props({confirm_dialog_setting:{title:"cloud_manager/no_player_data/title",tip:"cloud_manager/no_player_data/content",btn_mid:{text:"cloud_variable/get_it",type:"primary",callback:function(){t.props.close_dialog({dialog_type:"confirm"})}}}}),this.props.show_dialog({dialog_type:"confirm"})}},{key:"on_expand_capacity_btn_click",value:(a=o()(i.a.mark((function e(){var t,a,r,c=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.expand_capacity_clicked){e.next=2;break}return e.abrupt("return");case 2:return t="expand_cv_server",e.prev=3,this.expand_capacity_clicked=!0,this.props.show_toast({id:t,type:"loading",content:"cloud_manager/expanding_capacity",timeout:!1}),e.next=8,B.b();case 8:if(a=e.sent){e.next=13;break}return this.props.hide_toast(t),this.expand_capacity_clicked=!1,e.abrupt("return");case 13:r=a.total_capacity,setTimeout((function(){c.props.update_toast({id:t,type:"success",content:"cloud_manager/expand_success",timeout:2e3}),c.props.action_set_cloud_dashboard_state({total_capacity:r}),c.expand_capacity_clicked=!1}),2e3),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(3),this.expand_capacity_clicked=!1,this.props.update_toast({id:t,type:"error",content:"bad_network_notice",timeout:2e3});case 21:case"end":return e.stop()}}),e,this,[[3,17]])}))),function(){return a.apply(this,arguments)})},{key:"render_project_lists",value:function(){var e=this,t=this.props.cloud_manager_state,a=t.cloud_projects,r=t.cloud_projects_num,i=b()(a,(function(t){var a=t.id,r=t.preview,i=t.name,c=t.n_variables;return E.createElement("div",{className:("".concat(a.toString()===e.state.selected_project_id?"th1-bg-0 th1-text-10":"th1-bg-9 th1-bg-hover-7 th1-text-t7")?"".concat(a.toString()===e.state.selected_project_id?"th1-bg-0 th1-text-10":"th1-bg-9 th1-bg-hover-7 th1-text-t7")+" ":"")+"project--2pzgU",key:a,onClick:e.on_project_click.bind(e,a),"data-report-click":"云服务-选择作品"},E.createElement("div",{className:"project-img--UkqdU"},E.createElement("div",{className:"project-img-border--1MQNQ"},E.createElement("img",{src:r,onLoad:e.on_project_img_load.bind(e)}))),E.createElement("div",{className:"project_info--2cLc5"},E.createElement("p",{className:"project_name--7pYPb"},i),E.createElement("p",{className:"project_data_sum--1gdiR"},c)))}));return E.createElement(E.Fragment,null,E.createElement("div",{className:"subtitle_2--3imCu"},this.props.intl.formatMessage({id:"cloud_manager/cloud_projects"},{projects_num:r||0})),E.createElement("div",{className:"project_lists--2SQua",ref:function(t){t&&(e.project_list_wrap=t)},onScroll:this.on_project_list_scroll.bind(this)},i))}},{key:"render_header",value:function(){return E.createElement("div",{className:"header--2iZTu"},E.createElement("div",{className:"header-title--3dlz0"},this.get_intl_msg("cloud_manager/cloudserver")))}},{key:"render_cloud_info_item",value:function(e,t,a,r,i){var c=this.props.cloud_manager_state;return E.createElement("div",{className:"data_category--3T2nF"},E.createElement("div",{className:"icon--2eZ6d"},E.createElement(H.c,{id:t,size:85,class_name:"th1-text-0 th1-text-s2"})),E.createElement("div",{className:"info-1--MULqs"},E.createElement("div",null,this.props.intl.formatMessage({id:"cloud_manager/".concat(e)})),E.createElement("div",null,this.props.intl.formatMessage({id:"cloud_manager/quantity"},{space:""}),": ",a)),E.createElement("div",{className:"info-2--LTdVz"},E.createElement("div",null,this.props.intl.formatMessage({id:r})),e===U.N_PRIVATE_CV&&E.createElement("span",{className:"n_players--2tQmE"},"(","".concat(this.props.intl.formatMessage({id:"cloud_manager/private_cv_capacity/n_players"}),": "),E.createElement("span",{className:"th1-text-0 th1-text-s2"},c.n_players),")"),E.createElement("div",{className:"capacity_num--1RVeQ"},i)))}},{key:"render_cloud_info",value:function(){var e=this.props.cloud_manager_state,t=e.n_players,a=e.total_private_variables,r=e.n_public_lists,i=e.n_private_variables,c=e.n_public_variables,o=t||a;return E.createElement("div",{className:"th1-bg-9 cloud-info-wrap--2cC4R"},E.createElement("div",{className:"current_project_title--FpIzo"},e.name||"--"),E.createElement("div",{className:"current_project_n_variables--34AGF"},"".concat(this.props.intl.formatMessage({id:"cloud_manager/data_sum"}),": ").concat(e.n_variables)),E.createElement("div",{className:"clear_btn_wrap--1mJBJ clear_btn--30osr"},E.createElement(H.a,{type:"primary-outline",border_radius:"14px",on_click:this.on_clear_btn_click.bind(this,o),width:70,height:30,data_report:"云服务-清空"},E.createElement(H.c,{id:"#iconqinglix",size:16,margin:"0 5px 0 0"}),E.createElement("span",{style:{fontSize:12,lineHeight:12}},this.get_intl_msg("cloud_manager/cleardata")))),E.createElement("div",{className:"cloud_info_content--36Ew0"},this.render_cloud_info_item(U.N_PUBLIC_CV,Object(S.k)(S.b.PUBLIC),c||0,"cloud_manager/public_cv_capacity",c||0),this.render_cloud_info_item(U.N_PRIVATE_CV,Object(S.k)(S.b.PRIVATE),i||0,"cloud_manager/private_cv_capacity",(i||0)+(t*i||0)),this.render_cloud_info_item(U.N_PUBLIC_LIST,Object(S.k)(S.b.PUBLIC_LIST),r||0,"cloud_manager/public_list_capacity",200*(r||0))))}},{key:"on_bar_mouse_move",value:function(e,t,a){var r=a.target.getBoundingClientRect(),i=r.top,c=r.height;this.setState({tooltip:{x:a.pageX,y:i+c,text_1:e,text_2:t}})}},{key:"on_bar_mouse_leave",value:function(){this.setState({tooltip:void 0})}},{key:"render_capacity",value:function(){var e=this.props.cloud_manager_state,t=e.public_var_total_num,a=e.public_list_total_num,r=e.private_var_total_num,i=e.server_space,c=e.total_capacity||0,o=0,n=0,s=0,l=0,_=0;null!=t&&null!=a&&null!=c&&null!=i&&(_=200*a,o=t/c*100,n=(l=Math.max(0,i-t-_))/c*100,s=200*a/c*100);var p=c-(e.server_space||0),d=p>1e3?"high":p>0?"medium":"low",u=c>=1e4;return E.createElement("div",{className:"server-capacity--2VeEy"},E.createElement("div",{className:k()("server-capacity-refresh",T,{autoResolveMultipleImports:!0,handleMissingStyleName:"warn"})},E.createElement(H.a,{border_radius:"11px",type:"primary-outline",on_click:this.on_refresh_click.bind(this),padding:"8px 8px",height:20,data_report:"云服务-刷新"},E.createElement("span",{style:{fontSize:12,lineHeight:12}},this.get_intl_msg("cloud_manager/refresh")))),E.createElement("div",{className:"subtitle--2Gf9T"},this.get_intl_msg("cloud_manager/server_capacity"),": ",E.createElement("span",null,i,"/",c)),E.createElement("div",{className:"data-size-bar--2J0Bx"},E.createElement("div",{className:"data-size-occupied--myHF4",onMouseMove:this.on_bar_mouse_move.bind(this,"".concat(this.props.intl.formatMessage({id:"cloud_manager/public_var_total_num"}),": ").concat(t),"".concat(this.props.intl.formatMessage({id:"cloud_manager/size"}),": ").concat(t)),onMouseLeave:this.on_bar_mouse_leave.bind(this),style:{width:"".concat(o,"%"),background:"#983EF7"}}),E.createElement("div",{className:"data-size-occupied--myHF4",onMouseMove:this.on_bar_mouse_move.bind(this,"".concat(this.props.intl.formatMessage({id:"cloud_manager/private_var_total_num"}),": ").concat(r),"".concat(this.props.intl.formatMessage({id:"cloud_manager/size"}),": ").concat(l)),onMouseLeave:this.on_bar_mouse_leave.bind(this),style:{width:"".concat(n,"%"),background:"#FF5C87"}}),E.createElement("div",{className:"data-size-occupied--myHF4",onMouseMove:this.on_bar_mouse_move.bind(this,"".concat(this.props.intl.formatMessage({id:"cloud_manager/public_list_total_num"}),": ").concat(a),"".concat(this.props.intl.formatMessage({id:"cloud_manager/size"}),": ").concat(_)),onMouseLeave:this.on_bar_mouse_leave.bind(this),style:{width:"".concat(s,"%"),background:"#FFCF0F"}})),E.createElement("div",{className:"chart_sample--njHMG"},E.createElement("span",{className:"icn_color--1pD20 purple--f0IYA"}),this.props.intl.formatMessage({id:"cloud_manager/n_public_variables"}),E.createElement("span",{className:"icn_color--1pD20 pink--1y8He"}),this.props.intl.formatMessage({id:"cloud_manager/n_private_variables"}),E.createElement("span",{className:"icn_color--1pD20 yellow--11H5u"}),this.props.intl.formatMessage({id:"cloud_manager/n_public_lists"})),E.createElement("div",{className:"th1-bg-9 tips--39kYG"},this.get_intl_msg("cloud_manager/capacity/".concat(d)),"high"!==d&&this.get_intl_msg("cloud_manager/free"),"high"!==d&&!u&&E.createElement(E.Fragment,null,this.get_intl_msg("cloud_manager/capacity/or_click_here"),E.createElement("span",{style:{cursor:"pointer"},className:"th1-text-0 th1-text-hover-m1 th1-text-active-m2 th1-text-s2 th1-text-hover-s1 th1-text-active-s1",onClick:this.on_expand_capacity_btn_click.bind(this),"data-report-click":"云服务-申请扩容"},this.props.intl.formatMessage({id:"cloud_manager/capacity/expand_capacity"})))))}},{key:"render",value:function(){return E.createElement(M.a,{type:"cloud_manager",on_request_close:this.on_request_close.bind(this),close_btn:{style:{color:"rgb(182, 182, 187)",top:"17px",right:"17px"},icon_id:"#iconicon_close"}},E.createElement("div",{className:"container--3zgME"},this.state.tooltip&&E.createElement("div",{className:"tooltip--1BMcK",style:{left:this.state.tooltip.x,top:this.state.tooltip.y}},E.createElement("p",null,this.state.tooltip.text_1),E.createElement("p",null,this.state.tooltip.text_2)),this.render_header(),E.createElement("div",{className:"content--2geLH"},E.createElement("div",{className:"left--2gR9D"},this.render_capacity(),this.render_project_lists()),this.render_cloud_info())))}}]),t}(E.Component);var O=Object(w.b)(Object(x.connect)((function(e){return{nickname:e.userinfo_state.nickname,avatar:e.userinfo_state.avatar,work_id:e.project_state.work_id,work_name:e.project_state.work_name,cloud_manager_state:e.cloud_manager_state}}),(function(e){return Object(N.bindActionCreators)({close_dialog:I.c,show_dialog:F.f,set_dialog_props:F.e,show_toast:z.d,hide_toast:z.b,update_toast:z.f,action_set_cloud_dashboard_state:G.l,fetch_projects:G.i,fetch_summary_info:G.j,summary_info_correction:G.k,fetch_project_info:G.h,action_delete_private_variables_data:G.g,update_project:G.m,update_project_info:G.l,clear_dashboard:G.f},e)}))(R))}}]);